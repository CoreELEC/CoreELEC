From c1f35a73de45a02562f32daa367d4deb6ed38b0e Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Sun, 17 Feb 2019 00:08:53 +0200
Subject: [PATCH 01/11] Rename addon to pvr.iptvarchive

---
 CMakeLists.txt                                |  6 +--
 README.md                                     |  2 +-
 pvr.iptvsimple/addon.xml.in                   | 54 +++++++++----------
 .../resource.language.af_za/strings.po        |  4 +-
 .../resource.language.am_et/strings.po        |  4 +-
 .../resource.language.ar_sa/strings.po        |  4 +-
 .../resource.language.az_az/strings.po        |  4 +-
 .../resource.language.be_by/strings.po        |  4 +-
 .../resource.language.bg_bg/strings.po        |  4 +-
 .../resource.language.bs_ba/strings.po        |  4 +-
 .../resource.language.ca_es/strings.po        |  4 +-
 .../resource.language.cs_cz/strings.po        |  4 +-
 .../resource.language.cy_gb/strings.po        |  4 +-
 .../resource.language.da_dk/strings.po        |  4 +-
 .../resource.language.de_de/strings.po        |  4 +-
 .../resource.language.el_gr/strings.po        |  4 +-
 .../resource.language.en_au/strings.po        |  4 +-
 .../resource.language.en_gb/strings.po        |  4 +-
 .../resource.language.en_nz/strings.po        |  4 +-
 .../resource.language.en_us/strings.po        |  4 +-
 .../language/resource.language.eo/strings.po  |  4 +-
 .../resource.language.es_ar/strings.po        |  4 +-
 .../resource.language.es_es/strings.po        |  4 +-
 .../resource.language.es_mx/strings.po        |  4 +-
 .../resource.language.et_ee/strings.po        |  4 +-
 .../resource.language.eu_es/strings.po        |  4 +-
 .../resource.language.fa_af/strings.po        |  4 +-
 .../resource.language.fa_ir/strings.po        |  4 +-
 .../resource.language.fi_fi/strings.po        |  4 +-
 .../resource.language.fo_fo/strings.po        |  4 +-
 .../resource.language.fr_ca/strings.po        |  4 +-
 .../resource.language.fr_fr/strings.po        |  4 +-
 .../resource.language.gl_es/strings.po        |  4 +-
 .../resource.language.he_il/strings.po        |  4 +-
 .../resource.language.hi_in/strings.po        |  4 +-
 .../resource.language.hr_hr/strings.po        |  4 +-
 .../resource.language.hu_hu/strings.po        |  4 +-
 .../resource.language.hy_am/strings.po        |  4 +-
 .../resource.language.id_id/strings.po        |  4 +-
 .../resource.language.is_is/strings.po        |  4 +-
 .../resource.language.it_it/strings.po        |  4 +-
 .../resource.language.ja_jp/strings.po        |  4 +-
 .../resource.language.ko_kr/strings.po        |  4 +-
 .../resource.language.lt_lt/strings.po        |  4 +-
 .../resource.language.lv_lv/strings.po        |  4 +-
 .../language/resource.language.mi/strings.po  |  4 +-
 .../resource.language.mk_mk/strings.po        |  4 +-
 .../resource.language.ml_in/strings.po        |  4 +-
 .../resource.language.mn_mn/strings.po        |  4 +-
 .../resource.language.ms_my/strings.po        |  4 +-
 .../resource.language.mt_mt/strings.po        |  4 +-
 .../resource.language.my_mm/strings.po        |  4 +-
 .../resource.language.nb_no/strings.po        |  4 +-
 .../resource.language.nl_nl/strings.po        |  4 +-
 .../resource.language.pl_pl/strings.po        |  4 +-
 .../resource.language.pt_br/strings.po        |  4 +-
 .../resource.language.pt_pt/strings.po        |  4 +-
 .../resource.language.ro_ro/strings.po        |  4 +-
 .../resource.language.ru_ru/strings.po        |  4 +-
 .../resource.language.si_lk/strings.po        |  4 +-
 .../resource.language.sk_sk/strings.po        |  4 +-
 .../resource.language.sl_si/strings.po        |  4 +-
 .../resource.language.sq_al/strings.po        |  4 +-
 .../resource.language.sr_rs/strings.po        |  4 +-
 .../resource.language.sr_rs@latin/strings.po  |  4 +-
 .../resource.language.sv_se/strings.po        |  4 +-
 .../language/resource.language.szl/strings.po |  4 +-
 .../resource.language.ta_in/strings.po        |  4 +-
 .../resource.language.te_in/strings.po        |  4 +-
 .../resource.language.tg_tj/strings.po        |  4 +-
 .../resource.language.th_th/strings.po        |  4 +-
 .../resource.language.tr_tr/strings.po        |  4 +-
 .../resource.language.uk_ua/strings.po        |  4 +-
 .../resource.language.uz_uz/strings.po        |  4 +-
 .../resource.language.vi_vn/strings.po        |  4 +-
 .../resource.language.zh_cn/strings.po        |  4 +-
 .../resource.language.zh_tw/strings.po        |  4 +-
 77 files changed, 179 insertions(+), 179 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index f636c80..766d853 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,5 +1,5 @@
 cmake_minimum_required(VERSION 3.5)
-project(pvr.iptvsimple)
+project(pvr.iptvarchive)
 
 set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${PROJECT_SOURCE_DIR})
 
@@ -26,9 +26,9 @@ set(IPTV_SOURCES src/client.cpp
 set(IPTV_HEADERS src/client.h
                  src/PVRIptvData.h)
 
-addon_version(pvr.iptvsimple IPTV)
+addon_version(pvr.iptvarchive IPTV)
 add_definitions(-DIPTV_VERSION=${IPTV_VERSION})
 
-build_addon(pvr.iptvsimple IPTV DEPLIBS)
+build_addon(pvr.iptvarchive IPTV DEPLIBS)
 
 include(CPack)
diff --git a/README.md b/README.md
index 3c79a78..2c29711 100644
--- a/README.md
+++ b/README.md
@@ -2,7 +2,7 @@
 [![Build Status](https://dev.azure.com/teamkodi/kodi-pvr/_apis/build/status/kodi-pvr.pvr.iptvsimple?branchName=Leia)](https://dev.azure.com/teamkodi/kodi-pvr/_build/latest?definitionId=57&branchName=Leia)
 [![Coverity Scan Build Status](https://scan.coverity.com/projects/5120/badge.svg)](https://scan.coverity.com/projects/5120)
 
-# IPTV Simple PVR
+# IPTV Archive PVR
 
 IPTV Live TV and Radio PVR client addon for [Kodi](https://kodi.tv)
 
diff --git a/pvr.iptvsimple/addon.xml.in b/pvr.iptvsimple/addon.xml.in
index 8ddd06a..8229399 100644
--- a/pvr.iptvsimple/addon.xml.in
+++ b/pvr.iptvsimple/addon.xml.in
@@ -1,8 +1,8 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <addon
-  id="pvr.iptvsimple"
+  id="pvr.iptvarchive"
   version="3.10.0"
-  name="PVR IPTV Simple Client"
+  name="PVR IPTV Archive Client"
   provider-name="nightik">
   <requires>@ADDON_DEPENDS@</requires>
   <extension
@@ -60,54 +60,54 @@
     <summary lang="uk_UA">PVR надбудова Kodi для підтримки IPTV. https://github.com/afedchin/Kodi-addon-iptvsimple/wiki/IPTV-Simple-Home</summary>
     <summary lang="zh_CN">Kodi PVR 插件需要 IPTV 支持。https://github.com/afedchin/Kodi-addon-iptvsimple/wiki/IPTV-Simple-Home</summary>
     <summary lang="zh_TW">支援IPTV的Kodi PVR附加元件。https://github.com/afedchin/Kodi-addon-iptvsimple/wiki/IPTV-Simple-Home</summary>
-    <description lang="af_ZA">IPTV Simple PVR kliënt ondersteun M3U speellyste, stroom van lewendige TV vir multisaai / unisaai bronne, luister na radio kanale en EPG.</description>
+    <description lang="af_ZA">IPTV Archive PVR kliënt ondersteun M3U speellyste, stroom van lewendige TV vir multisaai / unisaai bronne, luister na radio kanale en EPG.</description>
     <description lang="bg_BG">Прост клиент за ПВР за телевизия по Интернет. Поддържа списъци за възпроизвеждане във формат „m3u“, поточно предавана телевизия от източници с излъчване мултикаст и уникаст, слушане на радио канали и електронен програмен справочник.</description>
     <description lang="ca_ES">Client senzill per a IPTV PVR compatible amb les llistes de reproducció m3u, transmissions en línia de TV en directe per als orígens difusió única o múltiple, escolta d'emissores de ràdio i guia electrònica de programació (EPG).</description>
     <description lang="cs_CZ">Jednoduchý klient PVR pro IPTV podporuje seznamy stop m3u, streamování živého vysílání pro zdroje vícesměrového nebo jednosměrového vysílání, poslech rozhlasových stanic a televizní program.</description>
-    <description lang="cy_GB">Mae Cleient IPTV Simple PVR yn cynnal rhestrau m3u, ffrydio Teledu Byw o ffynonellau darlledu eang ac unigol, gwrando ar sianeli Radio ac Amserlen Rhaglenni.</description>
+    <description lang="cy_GB">Mae Cleient IPTV Archive PVR yn cynnal rhestrau m3u, ffrydio Teledu Byw o ffynonellau darlledu eang ac unigol, gwrando ar sianeli Radio ac Amserlen Rhaglenni.</description>
     <description lang="da_DK">IPTV Simpel PVR klient understøttelse M3U-afspilningslister, streaming af direkte tv til multicast/unicast kilder, lytte til radio kanaler og EPG.</description>
-    <description lang="de_DE">IPTV Simple PVR Client unterstützt m3u Wiedergabelisten, Streaming von Live TV für Multicast/Unicast Quellen, Radiosender und EPG.</description>
+    <description lang="de_DE">IPTV Archive PVR Client unterstützt m3u Wiedergabelisten, Streaming von Live TV für Multicast/Unicast Quellen, Radiosender und EPG.</description>
     <description lang="el_GR">Απλός Πελάτης PVR του IPTV, με υποστήριξη λιστών αναπαραγωγής m3u, αναπαραγωγή ροών Live TV για πηγές πολλαπλής/μοναδικής διανομής, ακρόαση ραδιοφωνικών καναλιών και EPG.</description>
-    <description lang="en_AU">IPTV Simple PVR Client support m3u playlists, streaming of Live TV for multicast/unicast sources, listening to Radio channels and EPG.</description>
-    <description lang="en_GB">IPTV Simple PVR Client support m3u playlists, streaming of Live TV for multicast/unicast sources, listening to Radio channels and EPG.&#10;    &#10;For documentation visit: https://github.com/kodi-pvr/pvr.iptvsimple/blob/Leia/README.md&#10;    </description>
-    <description lang="en_NZ">IPTV Simple PVR Client support m3u playlists, streaming of Live TV for multicast/unicast sources, listening to Radio channels and EPG.</description>
-    <description lang="en_US">IPTV Simple PVR Client support m3u playlists, streaming of Live TV for multicast/unicast sources, listening to Radio channels and EPG.</description>
+    <description lang="en_AU">IPTV Archive PVR Client support m3u playlists, streaming of Live TV for multicast/unicast sources, listening to Radio channels and EPG.</description>
+    <description lang="en_GB">IPTV Archive PVR Client support m3u playlists, streaming of Live TV for multicast/unicast sources, listening to Radio channels and EPG.&#10;    &#10;For documentation visit: https://github.com/kodi-pvr/pvr.iptvsimple/blob/Leia/README.md&#10;    </description>
+    <description lang="en_NZ">IPTV Archive PVR Client support m3u playlists, streaming of Live TV for multicast/unicast sources, listening to Radio channels and EPG.</description>
+    <description lang="en_US">IPTV Archive PVR Client support m3u playlists, streaming of Live TV for multicast/unicast sources, listening to Radio channels and EPG.</description>
     <description lang="es_AR">Cliente simple PVR IPTV.  Reproduce de TV en Vivo multicast/unicast y listas m3u8&#10; . reproduce tambien canales de radio y GEP</description>
-    <description lang="es_ES">El cliente PVR IPTV Simple soporta listas M3U, reproducción de TV en Vivo para origenes multicast/unicast, escucha de canales de radio y EPG</description>
-    <description lang="es_MX">IPTV Simple PVR Client soporta listas de reproducción m3u, streaming de Live TV para fuentes multicast / unicast, escuchando para canales de radio y EPG.</description>
+    <description lang="es_ES">El cliente PVR IPTV Archive soporta listas M3U, reproducción de TV en Vivo para origenes multicast/unicast, escucha de canales de radio y EPG</description>
+    <description lang="es_MX">IPTV Archive PVR Client soporta listas de reproducción m3u, streaming de Live TV para fuentes multicast / unicast, escuchando para canales de radio y EPG.</description>
     <description lang="fi_FI">IPTV-lisäosa tukee m3u-toistolistoja, multicast/unicast-tv-lähetysten toistoa, radiokanavia ja ohjelmaopasta.</description>
     <description lang="fr_CA">Client de numériscope simple pour IPTV, prenant en charge les listes de lecture m3u, la diffusion en continu des télés en direct pour les sources de multidiffusion et de monodiffusion, l’écoute de chaînes radio, et le GÉP.</description>
-    <description lang="fr_FR">Le client enregistreur vidéo (PVR) IPTV Simple gère les listes de lecture M3U, la diffusion en continu de la TV en direct en mono ou multidiffusion, l'écoute des chaînes radio et le guide électronique des programmes TV.</description>
+    <description lang="fr_FR">Le client enregistreur vidéo (PVR) IPTV Archive gère les listes de lecture M3U, la diffusion en continu de la TV en direct en mono ou multidiffusion, l'écoute des chaînes radio et le guide électronique des programmes TV.</description>
     <description lang="gl_ES">O cliente PVR simple de IPTV soporta listaxes m3u, transmisión de TV en directo para fontes multicast/unicast, escoita de canles de Radio e Guía.</description>
-    <description lang="he_IL">לקוח טלוויזיה חיה IPTV Simple תומך ברשימות m3u, הזרמת שידורים חיים ממקור מרובב/ סטרים בודד, האזנה לתחנות רדיו והצגת לוח שידורים.</description>
-    <description lang="hr_HR">IPTV Simple PVR klijent podržava m3u popise izvođenja, streamanje TV programa s više ili jednog izvora, slušanje radio programa i elektronski programski vodič (EPG).</description>
+    <description lang="he_IL">לקוח טלוויזיה חיה IPTV Archive תומך ברשימות m3u, הזרמת שידורים חיים ממקור מרובב/ סטרים בודד, האזנה לתחנות רדיו והצגת לוח שידורים.</description>
+    <description lang="hr_HR">IPTV Archive PVR klijent podržava m3u popise izvođenja, streamanje TV programa s više ili jednog izvora, slušanje radio programa i elektronski programski vodič (EPG).</description>
     <description lang="hu_HU">Az IPTV PVR kiegészítő támogatja m3u listák lejátszását, élő TV adások hálózati streamelését, rádióadók hallgatását EPG adatok kezelésével.</description>
     <description lang="id_ID">IPTV, klien PTV sederhana yang mendukung playlist m3u, pengaliran siaran TV langsung untuk sumber multicast/unicast, mendengarkan radio dan EPG.</description>
     <description lang="is_IS">Einfaldur upptökubiðlari fyrir IPTV sem styður m3u spilunarlista, streymingu af beinum útsendingum frá multicast/unicast þjónustum, hlustun á útvarpsrásir og rafræna dagskrárvísa</description>
-    <description lang="it_IT">Il client IPTV Simple PVR supporta playlist m3u, streaming della Live TV per sorgenti multicast/unicast e ascoltare canali Radio ed EPG.</description>
+    <description lang="it_IT">Il client IPTV Archive PVR supporta playlist m3u, streaming della Live TV per sorgenti multicast/unicast e ascoltare canali Radio ed EPG.</description>
     <description lang="ja_JP">IPTV シンプル PVR クライアントは、m3u プレイリスト、マルチキャスト/ユニキャストのライブ TV ストリーミング、ラジオチャンネルや EPG の視聴をサポートしています。</description>
-    <description lang="ko_KR">IPTV Simple PVR 클라이언트는 m3u 재생목록, 스트리밍, 멀티캐스트/유니캐스트 소스의 TV 시청, 라디오 채널과 EPG를 통한 청취를 지원합니다.</description>
-    <description lang="lt_LT">IPTV Simple PVR klientas palaiko m3u grojaraščius, TV transliacijas iš multicast/unicast šaltinių, radijo stočių transliacijas ir EPG.</description>
+    <description lang="ko_KR">IPTV Archive PVR 클라이언트는 m3u 재생목록, 스트리밍, 멀티캐스트/유니캐스트 소스의 TV 시청, 라디오 채널과 EPG를 통한 청취를 지원합니다.</description>
+    <description lang="lt_LT">IPTV Archive PVR klientas palaiko m3u grojaraščius, TV transliacijas iš multicast/unicast šaltinių, radijo stočių transliacijas ir EPG.</description>
     <description lang="lv_LV">IPTV vienkāršais PVR klients atbalsta m3u spēļsarakstus, tiešraides TV straumēšanu multiraides/uniraides avotiem, radio kanālu klausīšanos un EPG.</description>
-    <description lang="mk_MK">IPTV Simple PVR Client поддржува m3u листи, гледање на Live TV од multicast/unicast извори, слушање Радио канали и EPG.</description>
-    <description lang="ms_MY">Klien PVR IPTV Simple menyokong senarai audio visual m3u, penstriman TV Langsung untuk sumber satu siaran/berbilang-siaran, mendengar saluran Radio dan EPG.</description>
-    <description lang="mt_MT">IPTV Simple PVR Client jiflaħ għal playlists m3u, streaming ta' TV Lajv għal sorsi multicast/unicast, smiegħ ta' stazzjonijiet tar-Radju u EPG.</description>
-    <description lang="nb_NO">IPTV Simple PVR-klient støtter m3u-spillelister, strømming av direkte-TV, lytting til radiokanaler og programguider.</description>
-    <description lang="nl_NL">IPTV Simple PVR cliënt ondersteunt m3u-afspeellijsten, streaming van live-TV voor multicast/unicastbronnen, luisteren naar radiozenders en EPG.</description>
+    <description lang="mk_MK">IPTV Archive PVR Client поддржува m3u листи, гледање на Live TV од multicast/unicast извори, слушање Радио канали и EPG.</description>
+    <description lang="ms_MY">Klien PVR IPTV Archive menyokong senarai audio visual m3u, penstriman TV Langsung untuk sumber satu siaran/berbilang-siaran, mendengar saluran Radio dan EPG.</description>
+    <description lang="mt_MT">IPTV Archive PVR Client jiflaħ għal playlists m3u, streaming ta' TV Lajv għal sorsi multicast/unicast, smiegħ ta' stazzjonijiet tar-Radju u EPG.</description>
+    <description lang="nb_NO">IPTV Archive PVR-klient støtter m3u-spillelister, strømming av direkte-TV, lytting til radiokanaler og programguider.</description>
+    <description lang="nl_NL">IPTV Archive PVR cliënt ondersteunt m3u-afspeellijsten, streaming van live-TV voor multicast/unicastbronnen, luisteren naar radiozenders en EPG.</description>
     <description lang="pl_PL">Klient telewizji dla telewizji internetowej obsługuje listy odtwarzania m3u, transmisję kanałów radiowych i telewizyjnych ze źródeł punktowych i grupowych oraz funkcje przewodnika telewizyjnego.</description>
-    <description lang="pt_BR">O cliente de PVR IPTV Simple Client oferece suporte para listas m3u, transmissão de TV ao vivo de fontes multicast/unicast, transmissão de rádios e, ainda, suporte a guia de programação eletrônico - EPG.</description>
-    <description lang="pt_PT">Cliente IPTV Simple PVR com suporte a listas de reprodução m3u, transmissão de TV em direto de fontes multidifusão/unidifusão, ouvir estações de rádio e EPG.</description>
+    <description lang="pt_BR">O cliente de PVR IPTV Archive Client oferece suporte para listas m3u, transmissão de TV ao vivo de fontes multicast/unicast, transmissão de rádios e, ainda, suporte a guia de programação eletrônico - EPG.</description>
+    <description lang="pt_PT">Cliente IPTV Archive PVR com suporte a listas de reprodução m3u, transmissão de TV em direto de fontes multidifusão/unidifusão, ouvir estações de rádio e EPG.</description>
     <description lang="ro_RO">PVR Client IPTV suporta liste m3u, redare TV în direct pentru surse de multicast/unicast, ascultare canale radio si EPG.</description>
     <description lang="ru_RU">Интерфейс для IPTV. Поддерживает просмотр потокового ТВ для юникаст/мультикаст источников, прослушивание радиоканалов и работу с электронным телегидом.</description>
     <description lang="sk_SK">Jednoduchý IPTV PVR klient podporuje mp3 zoznamy súborov, streamovanie živého televízneho vysielania ako multicast/unicast zdroje, počúvanie rozhlasových kanálov a EPG.</description>
-    <description lang="sl_SI">IPTV Simple odjemalec PVR podpira sezname m3u, pretakanja TV v živo za vire multicast/unicast, poslušenje radijskih postaj in EPG.</description>
+    <description lang="sl_SI">IPTV Archive odjemalec PVR podpira sezname m3u, pretakanja TV v živo za vire multicast/unicast, poslušenje radijskih postaj in EPG.</description>
     <description lang="sr_RS">IPTV Једноставан PVR Клијент подржава m3u листе за репродукцију, стримовање ТВ Уживо за multicast/unicast изворе, слушање Радио канала и EPG.</description>
     <description lang="sr_RS@latin">IPTV Jednostavan PVR Klijent podržava m3u liste za reprodukciju, strimovanje TV Uživo za multicast/unicast izvore, slušanje Radio kanala i EPG.</description>
-    <description lang="sv_SE">IPTV Simple PVR Client stöder m3u-spellistor, strömmande Live-TV för multicast/unicast-källor, radiolyssning och EPG.</description>
+    <description lang="sv_SE">IPTV Archive PVR Client stöder m3u-spellistor, strömmande Live-TV för multicast/unicast-källor, radiolyssning och EPG.</description>
     <description lang="szl">Klijynt telewizyje dlŏ telewizyje internetowyj ôbsuguje wykŏzy ôdtwŏrzaniŏ m3u, szpricowanie kanałōw radyjowych i telewizyjnych ze źrōdeł pōnktowych i skupinowych, a tyż fōnkcyje EPG.</description>
     <description lang="tr_TR">IPTV Basit PVR İstemcisi m3u çalma listeleri, multicast/unicast kaynaklar için Canlı TV akışı, radyo kanallarını dinleme ve EPG destekler.</description>
     <description lang="zh_CN">IPTV 简单 PVR 前端支持 m3u 播放列表、多播/单播源直播电视、收听电台和电子节目单。</description>
-    <description lang="zh_TW">IPTV Simple PVR 用戶端支援m3u 播放列表，來自multicast/unicast 的即時電視串流，收聽廣播及電子節目表。</description>
+    <description lang="zh_TW">IPTV Archive PVR 用戶端支援m3u 播放列表，來自multicast/unicast 的即時電視串流，收聽廣播及電子節目表。</description>
     <disclaimer lang="af_ZA">Hierdie is onstabiele sagteware! Die outeurs is op geen manier verantwoordelik vir gefaalde spele, inkorrekte EPG tye, vermorsde ure, of enige ander ongewensde effekte.</disclaimer>
     <disclaimer lang="bg_BG">Тази програма е нестабилна! Авторите не носят отговорност за неуспешно възпроизвеждане, некоректни часове в електронния програмен справочник, пропиляното време и други нежелани ефекти.</disclaimer>
     <disclaimer lang="ca_ES">Aquest programari és inestable! Els autors no es fan responsables de reproduccions fallides, horaris incorrectes a la guia electrònica de programació (EPG), hores perdudes o qualsevol altre efecte no desitjat.</disclaimer>
diff --git a/pvr.iptvsimple/resources/language/resource.language.af_za/strings.po b/pvr.iptvsimple/resources/language/resource.language.af_za/strings.po
index 4fdc042..8bb35c3 100644
--- a/pvr.iptvsimple/resources/language/resource.language.af_za/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.af_za/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.am_et/strings.po b/pvr.iptvsimple/resources/language/resource.language.am_et/strings.po
index 471bd97..14ec121 100644
--- a/pvr.iptvsimple/resources/language/resource.language.am_et/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.am_et/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ar_sa/strings.po b/pvr.iptvsimple/resources/language/resource.language.ar_sa/strings.po
index 373ff57..5180067 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ar_sa/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ar_sa/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.az_az/strings.po b/pvr.iptvsimple/resources/language/resource.language.az_az/strings.po
index 1a40898..b48012a 100644
--- a/pvr.iptvsimple/resources/language/resource.language.az_az/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.az_az/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.be_by/strings.po b/pvr.iptvsimple/resources/language/resource.language.be_by/strings.po
index d55ef08..5de820f 100644
--- a/pvr.iptvsimple/resources/language/resource.language.be_by/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.be_by/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.bg_bg/strings.po b/pvr.iptvsimple/resources/language/resource.language.bg_bg/strings.po
index 7b0d457..f846e07 100644
--- a/pvr.iptvsimple/resources/language/resource.language.bg_bg/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.bg_bg/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.bs_ba/strings.po b/pvr.iptvsimple/resources/language/resource.language.bs_ba/strings.po
index 52566eb..2f5f5ff 100644
--- a/pvr.iptvsimple/resources/language/resource.language.bs_ba/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.bs_ba/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ca_es/strings.po b/pvr.iptvsimple/resources/language/resource.language.ca_es/strings.po
index 3dc58b8..9845531 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ca_es/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ca_es/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.cs_cz/strings.po b/pvr.iptvsimple/resources/language/resource.language.cs_cz/strings.po
index e912747..00a856c 100644
--- a/pvr.iptvsimple/resources/language/resource.language.cs_cz/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.cs_cz/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.cy_gb/strings.po b/pvr.iptvsimple/resources/language/resource.language.cy_gb/strings.po
index cd0101e..6d4ad89 100644
--- a/pvr.iptvsimple/resources/language/resource.language.cy_gb/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.cy_gb/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.da_dk/strings.po b/pvr.iptvsimple/resources/language/resource.language.da_dk/strings.po
index 2c00e85..670fc1a 100644
--- a/pvr.iptvsimple/resources/language/resource.language.da_dk/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.da_dk/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po b/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
index 56ab81c..3a27788 100644
--- a/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.el_gr/strings.po b/pvr.iptvsimple/resources/language/resource.language.el_gr/strings.po
index baec770..466263e 100644
--- a/pvr.iptvsimple/resources/language/resource.language.el_gr/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.el_gr/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.en_au/strings.po b/pvr.iptvsimple/resources/language/resource.language.en_au/strings.po
index 3f65c28..1384774 100644
--- a/pvr.iptvsimple/resources/language/resource.language.en_au/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.en_au/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po b/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
index 040eab4..9967547 100644
--- a/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.en_nz/strings.po b/pvr.iptvsimple/resources/language/resource.language.en_nz/strings.po
index 6ae258c..0cead77 100644
--- a/pvr.iptvsimple/resources/language/resource.language.en_nz/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.en_nz/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.en_us/strings.po b/pvr.iptvsimple/resources/language/resource.language.en_us/strings.po
index 99a3210..53b11aa 100644
--- a/pvr.iptvsimple/resources/language/resource.language.en_us/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.en_us/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.eo/strings.po b/pvr.iptvsimple/resources/language/resource.language.eo/strings.po
index 3b613b3..aaa3432 100644
--- a/pvr.iptvsimple/resources/language/resource.language.eo/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.eo/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.es_ar/strings.po b/pvr.iptvsimple/resources/language/resource.language.es_ar/strings.po
index e1589ef..532aaba 100644
--- a/pvr.iptvsimple/resources/language/resource.language.es_ar/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.es_ar/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.es_es/strings.po b/pvr.iptvsimple/resources/language/resource.language.es_es/strings.po
index 8c44a56..06ccfca 100644
--- a/pvr.iptvsimple/resources/language/resource.language.es_es/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.es_es/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.es_mx/strings.po b/pvr.iptvsimple/resources/language/resource.language.es_mx/strings.po
index 21cdecc..0d33afd 100644
--- a/pvr.iptvsimple/resources/language/resource.language.es_mx/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.es_mx/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.et_ee/strings.po b/pvr.iptvsimple/resources/language/resource.language.et_ee/strings.po
index 04a0c00..7e99a99 100644
--- a/pvr.iptvsimple/resources/language/resource.language.et_ee/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.et_ee/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.eu_es/strings.po b/pvr.iptvsimple/resources/language/resource.language.eu_es/strings.po
index ab05c1f..0de709b 100644
--- a/pvr.iptvsimple/resources/language/resource.language.eu_es/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.eu_es/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.fa_af/strings.po b/pvr.iptvsimple/resources/language/resource.language.fa_af/strings.po
index fa60107..1084357 100644
--- a/pvr.iptvsimple/resources/language/resource.language.fa_af/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.fa_af/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.fa_ir/strings.po b/pvr.iptvsimple/resources/language/resource.language.fa_ir/strings.po
index 34a932f..b13770f 100644
--- a/pvr.iptvsimple/resources/language/resource.language.fa_ir/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.fa_ir/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.fi_fi/strings.po b/pvr.iptvsimple/resources/language/resource.language.fi_fi/strings.po
index dd63096..c51d6bf 100644
--- a/pvr.iptvsimple/resources/language/resource.language.fi_fi/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.fi_fi/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.fo_fo/strings.po b/pvr.iptvsimple/resources/language/resource.language.fo_fo/strings.po
index 40041e2..0e1f886 100644
--- a/pvr.iptvsimple/resources/language/resource.language.fo_fo/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.fo_fo/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.fr_ca/strings.po b/pvr.iptvsimple/resources/language/resource.language.fr_ca/strings.po
index 4370f3b..6ba8982 100644
--- a/pvr.iptvsimple/resources/language/resource.language.fr_ca/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.fr_ca/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.fr_fr/strings.po b/pvr.iptvsimple/resources/language/resource.language.fr_fr/strings.po
index f379982..d0b45c5 100644
--- a/pvr.iptvsimple/resources/language/resource.language.fr_fr/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.fr_fr/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.gl_es/strings.po b/pvr.iptvsimple/resources/language/resource.language.gl_es/strings.po
index 16dbeb8..df64fb8 100644
--- a/pvr.iptvsimple/resources/language/resource.language.gl_es/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.gl_es/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.he_il/strings.po b/pvr.iptvsimple/resources/language/resource.language.he_il/strings.po
index 9a295cb..48826fc 100644
--- a/pvr.iptvsimple/resources/language/resource.language.he_il/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.he_il/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.hi_in/strings.po b/pvr.iptvsimple/resources/language/resource.language.hi_in/strings.po
index b59adff..9740206 100644
--- a/pvr.iptvsimple/resources/language/resource.language.hi_in/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.hi_in/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.hr_hr/strings.po b/pvr.iptvsimple/resources/language/resource.language.hr_hr/strings.po
index e3f518c..2bbef1c 100644
--- a/pvr.iptvsimple/resources/language/resource.language.hr_hr/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.hr_hr/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.hu_hu/strings.po b/pvr.iptvsimple/resources/language/resource.language.hu_hu/strings.po
index 87447d5..60ab2ea 100644
--- a/pvr.iptvsimple/resources/language/resource.language.hu_hu/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.hu_hu/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.hy_am/strings.po b/pvr.iptvsimple/resources/language/resource.language.hy_am/strings.po
index 9d3d5c6..cff4f57 100644
--- a/pvr.iptvsimple/resources/language/resource.language.hy_am/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.hy_am/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.id_id/strings.po b/pvr.iptvsimple/resources/language/resource.language.id_id/strings.po
index 08fbf86..8fdf61c 100644
--- a/pvr.iptvsimple/resources/language/resource.language.id_id/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.id_id/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.is_is/strings.po b/pvr.iptvsimple/resources/language/resource.language.is_is/strings.po
index 0d54762..9f50a93 100644
--- a/pvr.iptvsimple/resources/language/resource.language.is_is/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.is_is/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.it_it/strings.po b/pvr.iptvsimple/resources/language/resource.language.it_it/strings.po
index 56d3a63..034e75d 100644
--- a/pvr.iptvsimple/resources/language/resource.language.it_it/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.it_it/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ja_jp/strings.po b/pvr.iptvsimple/resources/language/resource.language.ja_jp/strings.po
index fb8c616..efbd152 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ja_jp/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ja_jp/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ko_kr/strings.po b/pvr.iptvsimple/resources/language/resource.language.ko_kr/strings.po
index 6482068..c2378bf 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ko_kr/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ko_kr/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.lt_lt/strings.po b/pvr.iptvsimple/resources/language/resource.language.lt_lt/strings.po
index 6f0cb07..fa856aa 100644
--- a/pvr.iptvsimple/resources/language/resource.language.lt_lt/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.lt_lt/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.lv_lv/strings.po b/pvr.iptvsimple/resources/language/resource.language.lv_lv/strings.po
index 5ccf3d6..4832c93 100644
--- a/pvr.iptvsimple/resources/language/resource.language.lv_lv/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.lv_lv/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.mi/strings.po b/pvr.iptvsimple/resources/language/resource.language.mi/strings.po
index 382ae9a..ce17b42 100644
--- a/pvr.iptvsimple/resources/language/resource.language.mi/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.mi/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.mk_mk/strings.po b/pvr.iptvsimple/resources/language/resource.language.mk_mk/strings.po
index 1cdfea7..ad5edd5 100644
--- a/pvr.iptvsimple/resources/language/resource.language.mk_mk/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.mk_mk/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ml_in/strings.po b/pvr.iptvsimple/resources/language/resource.language.ml_in/strings.po
index dddb000..822c17f 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ml_in/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ml_in/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.mn_mn/strings.po b/pvr.iptvsimple/resources/language/resource.language.mn_mn/strings.po
index 2184fd2..6166858 100644
--- a/pvr.iptvsimple/resources/language/resource.language.mn_mn/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.mn_mn/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ms_my/strings.po b/pvr.iptvsimple/resources/language/resource.language.ms_my/strings.po
index d99a75b..ef6ea92 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ms_my/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ms_my/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.mt_mt/strings.po b/pvr.iptvsimple/resources/language/resource.language.mt_mt/strings.po
index ff6a752..59ae240 100644
--- a/pvr.iptvsimple/resources/language/resource.language.mt_mt/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.mt_mt/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.my_mm/strings.po b/pvr.iptvsimple/resources/language/resource.language.my_mm/strings.po
index ab47a18..2f75a3e 100644
--- a/pvr.iptvsimple/resources/language/resource.language.my_mm/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.my_mm/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.nb_no/strings.po b/pvr.iptvsimple/resources/language/resource.language.nb_no/strings.po
index 41ca51f..c95a574 100644
--- a/pvr.iptvsimple/resources/language/resource.language.nb_no/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.nb_no/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.nl_nl/strings.po b/pvr.iptvsimple/resources/language/resource.language.nl_nl/strings.po
index 91a8da0..bfae0e1 100644
--- a/pvr.iptvsimple/resources/language/resource.language.nl_nl/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.nl_nl/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.pl_pl/strings.po b/pvr.iptvsimple/resources/language/resource.language.pl_pl/strings.po
index 8dfed18..5754d30 100644
--- a/pvr.iptvsimple/resources/language/resource.language.pl_pl/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.pl_pl/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.pt_br/strings.po b/pvr.iptvsimple/resources/language/resource.language.pt_br/strings.po
index df5629c..9ff7dc9 100644
--- a/pvr.iptvsimple/resources/language/resource.language.pt_br/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.pt_br/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.pt_pt/strings.po b/pvr.iptvsimple/resources/language/resource.language.pt_pt/strings.po
index 0aa13ce..f0b2823 100644
--- a/pvr.iptvsimple/resources/language/resource.language.pt_pt/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.pt_pt/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ro_ro/strings.po b/pvr.iptvsimple/resources/language/resource.language.ro_ro/strings.po
index d4fa3e7..ab20240 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ro_ro/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ro_ro/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po b/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
index 108b46c..175e8dc 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.si_lk/strings.po b/pvr.iptvsimple/resources/language/resource.language.si_lk/strings.po
index 0d1a1f6..a205c4a 100644
--- a/pvr.iptvsimple/resources/language/resource.language.si_lk/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.si_lk/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.sk_sk/strings.po b/pvr.iptvsimple/resources/language/resource.language.sk_sk/strings.po
index 2c0e45a..9b29558 100644
--- a/pvr.iptvsimple/resources/language/resource.language.sk_sk/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.sk_sk/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.sl_si/strings.po b/pvr.iptvsimple/resources/language/resource.language.sl_si/strings.po
index 6eb13cd..82170dc 100644
--- a/pvr.iptvsimple/resources/language/resource.language.sl_si/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.sl_si/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.sq_al/strings.po b/pvr.iptvsimple/resources/language/resource.language.sq_al/strings.po
index b432c4d..b45af45 100644
--- a/pvr.iptvsimple/resources/language/resource.language.sq_al/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.sq_al/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.sr_rs/strings.po b/pvr.iptvsimple/resources/language/resource.language.sr_rs/strings.po
index caa608e..08981ac 100644
--- a/pvr.iptvsimple/resources/language/resource.language.sr_rs/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.sr_rs/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.sr_rs@latin/strings.po b/pvr.iptvsimple/resources/language/resource.language.sr_rs@latin/strings.po
index 999fac9..d222bf4 100644
--- a/pvr.iptvsimple/resources/language/resource.language.sr_rs@latin/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.sr_rs@latin/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.sv_se/strings.po b/pvr.iptvsimple/resources/language/resource.language.sv_se/strings.po
index db6d1a7..a5771b4 100644
--- a/pvr.iptvsimple/resources/language/resource.language.sv_se/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.sv_se/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.szl/strings.po b/pvr.iptvsimple/resources/language/resource.language.szl/strings.po
index 82b2522..d9b13e1 100644
--- a/pvr.iptvsimple/resources/language/resource.language.szl/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.szl/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ta_in/strings.po b/pvr.iptvsimple/resources/language/resource.language.ta_in/strings.po
index a268832..13da0b8 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ta_in/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ta_in/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.te_in/strings.po b/pvr.iptvsimple/resources/language/resource.language.te_in/strings.po
index 8ef4887..045e064 100644
--- a/pvr.iptvsimple/resources/language/resource.language.te_in/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.te_in/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.tg_tj/strings.po b/pvr.iptvsimple/resources/language/resource.language.tg_tj/strings.po
index 9a4f571..673e213 100644
--- a/pvr.iptvsimple/resources/language/resource.language.tg_tj/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.tg_tj/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.th_th/strings.po b/pvr.iptvsimple/resources/language/resource.language.th_th/strings.po
index 8f78334..cf25f86 100644
--- a/pvr.iptvsimple/resources/language/resource.language.th_th/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.th_th/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.tr_tr/strings.po b/pvr.iptvsimple/resources/language/resource.language.tr_tr/strings.po
index 479b4c1..cf763df 100644
--- a/pvr.iptvsimple/resources/language/resource.language.tr_tr/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.tr_tr/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.uk_ua/strings.po b/pvr.iptvsimple/resources/language/resource.language.uk_ua/strings.po
index 6e20a65..bf3e2d3 100644
--- a/pvr.iptvsimple/resources/language/resource.language.uk_ua/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.uk_ua/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.uz_uz/strings.po b/pvr.iptvsimple/resources/language/resource.language.uz_uz/strings.po
index 17a1d32..e62452e 100644
--- a/pvr.iptvsimple/resources/language/resource.language.uz_uz/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.uz_uz/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.vi_vn/strings.po b/pvr.iptvsimple/resources/language/resource.language.vi_vn/strings.po
index 530d0f2..35da214 100644
--- a/pvr.iptvsimple/resources/language/resource.language.vi_vn/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.vi_vn/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.zh_cn/strings.po b/pvr.iptvsimple/resources/language/resource.language.zh_cn/strings.po
index d096639..085a47b 100644
--- a/pvr.iptvsimple/resources/language/resource.language.zh_cn/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.zh_cn/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.zh_tw/strings.po b/pvr.iptvsimple/resources/language/resource.language.zh_tw/strings.po
index d0ddce8..701eb4e 100644
--- a/pvr.iptvsimple/resources/language/resource.language.zh_tw/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.zh_tw/strings.po
@@ -1,6 +1,6 @@
 # Kodi Media Center language file
-# Addon Name: PVR IPTV Simple Client
-# Addon id: pvr.iptvsimple
+# Addon Name: PVR IPTV Archive Client
+# Addon id: pvr.iptvarchive
 # Addon Provider: nightik
 msgid ""
 msgstr ""
-- 
2.25.1


From 26e238e0e3f5fefaaf21adcd089f04ba8bbc73e7 Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Sun, 17 Feb 2019 00:10:45 +0200
Subject: [PATCH 02/11] Add archive support to addon

---
 CMakeLists.txt                                |   6 +-
 .../resource.language.de_de/strings.po        |  98 ++++++++
 .../resource.language.en_gb/strings.po        |  98 ++++++++
 .../resource.language.ru_ru/strings.po        |  98 ++++++++
 pvr.iptvsimple/resources/settings.xml         |  13 ++
 src/ArchiveConfig.cpp                         | 144 ++++++++++++
 src/ArchiveConfig.h                           |  52 +++++
 src/PVRIptvData.cpp                           | 221 ++++++++++++++----
 src/PVRIptvData.h                             |  20 +-
 src/client.cpp                                | 217 +++++++++++++++--
 10 files changed, 895 insertions(+), 72 deletions(-)
 create mode 100644 src/ArchiveConfig.cpp
 create mode 100644 src/ArchiveConfig.h

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 766d853..12dcea3 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -21,10 +21,12 @@ set(DEPLIBS ${p8-platform_LIBRARIES}
 message(STATUS "ZLIB_LIBRARIES: ${ZLIB_LIBRARIES}")
 
 set(IPTV_SOURCES src/client.cpp
-                 src/PVRIptvData.cpp)
+                 src/PVRIptvData.cpp
+                 src/ArchiveConfig.cpp)
 
 set(IPTV_HEADERS src/client.h
-                 src/PVRIptvData.h)
+                 src/PVRIptvData.h
+                 src/ArchiveConfig.h)
 
 addon_version(pvr.iptvarchive IPTV)
 add_definitions(-DIPTV_VERSION=${IPTV_VERSION})
diff --git a/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po b/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
index 3a27788..57d1801 100644
--- a/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
@@ -103,3 +103,101 @@ msgstr "M3U bevorzugen"
 msgctxt "#30044"
 msgid "Prefer XMLTV"
 msgstr "XMLTV bevorzugen"
+
+#empty strings from id 30045 to 30059
+
+msgctxt "#30060"
+msgid "Archive Settings"
+msgstr "Einstellungen für Archive"
+
+msgctxt "#30061"
+msgid "Enable Archive support"
+msgstr "Archiv-Unterstützung aktivieren"
+
+msgctxt "#30062"
+msgid "Archive URL format"
+msgstr "Archiv URL Format"
+
+msgctxt "#30063"
+msgid "Timeshift Settings"
+msgstr "Einstellungen Zeitversetzung"
+
+msgctxt "#30064"
+msgid "Timeshift buffer"
+msgstr "Puffer Zeitversetzung"
+
+msgctxt "#30065"
+msgid "Watch From EPG Settings"
+msgstr "Ansehen aus EPG-Einstellungen"
+
+msgctxt "#30066"
+msgid "Extra time before program start"
+msgstr "Zusätzliche Zeit vor Programmbeginn"
+
+msgctxt "#30067"
+msgid "Extra time after program end"
+msgstr "Zusätzliche Zeit nach Programmschluss"
+
+msgctxt "#30068"
+msgid "Play from EPG in Live TV mode (using timeshift)"
+msgstr "Aus EPG in Live TV mode abspielen (mit Timeshift)"
+
+#empty strings from id 30069 to 30079
+
+msgctxt "#30080"
+msgid "None"
+msgstr "Keine"
+
+msgctxt "#30081"
+msgid "2 minutes"
+msgstr "2 Minuten"
+
+msgctxt "#30082"
+msgid "5 minutes"
+msgstr "5 Minuten"
+
+msgctxt "#30083"
+msgid "10 minutes"
+msgstr "10 Minuten"
+
+msgctxt "#30084"
+msgid "15 minutes"
+msgstr "15 Minuten"
+
+msgctxt "#30085"
+msgid "30 minutes"
+msgstr "30 Minuten"
+
+msgctxt "#30086"
+msgid "60 minutes"
+msgstr "60 Minuten"
+
+#empty strings from id 30087 to 30089
+
+msgctxt "#30090"
+msgid "1 day"
+msgstr "1 Tag"
+
+msgctxt "#30091"
+msgid "2 days"
+msgstr "2 Tage"
+
+msgctxt "#30092"
+msgid "3 days"
+msgstr "3 Tage"
+
+msgctxt "#30093"
+msgid "4 days"
+msgstr "4 Tage"
+
+msgctxt "#30094"
+msgid "5 days"
+msgstr "5 Tage"
+
+msgctxt "#30095"
+msgid "6 days"
+msgstr "6 Tage"
+
+msgctxt "#30096"
+msgid "7 days"
+msgstr "7 Tage"
diff --git a/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po b/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
index 9967547..2f11805 100644
--- a/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
@@ -117,3 +117,101 @@ msgstr ""
 msgctxt "#30045"
 msgid "Change User-Agent"
 msgstr ""
+
+#empty strings from id 30046 to 30059
+
+msgctxt "#30060"
+msgid "Archive Settings"
+msgstr ""
+
+msgctxt "#30061"
+msgid "Enable Archive support"
+msgstr ""
+
+msgctxt "#30062"
+msgid "Archive URL format"
+msgstr ""
+
+msgctxt "#30063"
+msgid "Timeshift Settings"
+msgstr ""
+
+msgctxt "#30064"
+msgid "Timeshift buffer"
+msgstr ""
+
+msgctxt "#30065"
+msgid "Watch From EPG Settings"
+msgstr ""
+
+msgctxt "#30066"
+msgid "Extra time before program start"
+msgstr ""
+
+msgctxt "#30067"
+msgid "Extra time after program end"
+msgstr ""
+
+msgctxt "#30068"
+msgid "Play from EPG in Live TV mode (using timeshift)"
+msgstr ""
+
+#empty strings from id 30069 to 30079
+
+msgctxt "#30080"
+msgid "None"
+msgstr ""
+
+msgctxt "#30081"
+msgid "2 minutes"
+msgstr ""
+
+msgctxt "#30082"
+msgid "5 minutes"
+msgstr ""
+
+msgctxt "#30083"
+msgid "10 minutes"
+msgstr ""
+
+msgctxt "#30084"
+msgid "15 minutes"
+msgstr ""
+
+msgctxt "#30085"
+msgid "30 minutes"
+msgstr ""
+
+msgctxt "#30086"
+msgid "60 minutes"
+msgstr ""
+
+#empty strings from id 30087 to 30089
+
+msgctxt "#30090"
+msgid "1 day"
+msgstr ""
+
+msgctxt "#30091"
+msgid "2 days"
+msgstr ""
+
+msgctxt "#30092"
+msgid "3 days"
+msgstr ""
+
+msgctxt "#30093"
+msgid "4 days"
+msgstr ""
+
+msgctxt "#30094"
+msgid "5 days"
+msgstr ""
+
+msgctxt "#30095"
+msgid "6 days"
+msgstr ""
+
+msgctxt "#30096"
+msgid "7 days"
+msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po b/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
index 175e8dc..8224a35 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
@@ -103,3 +103,101 @@ msgstr "Предпочтительно M3U"
 msgctxt "#30044"
 msgid "Prefer XMLTV"
 msgstr "Предпочтительно XMLTV"
+
+#empty strings from id 30045 to 30059
+
+msgctxt "#30060"
+msgid "Archive Settings"
+msgstr "Настройки Архива"
+
+msgctxt "#30061"
+msgid "Enable Archive support"
+msgstr "Включить поддержку Архива"
+
+msgctxt "#30062"
+msgid "Archive URL format"
+msgstr "Формат ссылки на Архив"
+
+msgctxt "#30063"
+msgid "Timeshift Settings"
+msgstr "Настройки Таймшифта"
+
+msgctxt "#30064"
+msgid "Timeshift buffer"
+msgstr "Буфер Таймшифта"
+
+msgctxt "#30065"
+msgid "Watch From EPG Settings"
+msgstr "Настройки просмотра из EPG"
+
+msgctxt "#30066"
+msgid "Extra time before program start"
+msgstr "Дополнительное время до начала программы"
+
+msgctxt "#30067"
+msgid "Extra time after program end"
+msgstr "Дополнительное время после окончания программы"
+
+msgctxt "#30068"
+msgid "Play from EPG in Live TV mode (using timeshift)"
+msgstr "Воспроизведение из EPG в режиме Live TV (используя Таймшифт)"
+
+#empty strings from id 30069 to 30079
+
+msgctxt "#30080"
+msgid "None"
+msgstr "Без"
+
+msgctxt "#30081"
+msgid "2 minutes"
+msgstr "2 минуты"
+
+msgctxt "#30082"
+msgid "5 minutes"
+msgstr "5 минут"
+
+msgctxt "#30083"
+msgid "10 minutes"
+msgstr "10 минут"
+
+msgctxt "#30084"
+msgid "15 minutes"
+msgstr "15 минут"
+
+msgctxt "#30085"
+msgid "30 minutes"
+msgstr "30 минут"
+
+msgctxt "#30086"
+msgid "60 minutes"
+msgstr "60 минут"
+
+#empty strings from id 30087 to 30089
+
+msgctxt "#30090"
+msgid "1 day"
+msgstr "1 день"
+
+msgctxt "#30091"
+msgid "2 days"
+msgstr "2 дня"
+
+msgctxt "#30092"
+msgid "3 days"
+msgstr "3 дня"
+
+msgctxt "#30093"
+msgid "4 days"
+msgstr "4 дня"
+
+msgctxt "#30094"
+msgid "5 days"
+msgstr "5 дней"
+
+msgctxt "#30095"
+msgid "6 days"
+msgstr "6 дней"
+
+msgctxt "#30096"
+msgid "7 days"
+msgstr "7 дней"
diff --git a/pvr.iptvsimple/resources/settings.xml b/pvr.iptvsimple/resources/settings.xml
index 6cc4eea..751d890 100644
--- a/pvr.iptvsimple/resources/settings.xml
+++ b/pvr.iptvsimple/resources/settings.xml
@@ -31,4 +31,17 @@
     <setting id="sep3" label="30040" type="lsep"/>
     <setting id="logoFromEpg" type="enum" label="30041" default="0" lvalues="30042|30043|30044"/>
   </category>
+
+  <!-- Archive -->
+  <category label="30060">
+    <setting id="sep4" label="30060" type="lsep"/>
+    <setting id="archEnable" type="bool" label="30061" default="false"/>
+    <setting id="archUrlFormat" type="text" label="30062" default="" visible="eq(-1,true)"/>
+    <setting id="sep4" label="30063" type="lsep" visible="eq(-2,true)"/>
+    <setting id="archTimeshiftBuffer" type="enum" label="30064" lvalues="30090|30091|30092|30093|30094|30095|30096" default="3" visible="eq(-3,true)"/>
+    <setting id="archPlayEpgAsLive" type="bool" label="30068" default="false" visible="eq(-4,true)"/>
+    <setting id="sep4" label="30065" type="lsep" visible="eq(-5,true) + !eq(-1,true)"/>
+    <setting id="archBeginBuffer" type="enum" label="30066" lvalues="30080|30081|30082|30083|30084|30085|30086" default="2" visible="eq(-6,true) + !eq(-2,true)"/>
+    <setting id="archEndBuffer" type="enum" label="30067" lvalues="30080|30081|30082|30083|30084|30085|30086" default="4" visible="eq(-7,true) + !eq(-3,true)"/>
+  </category>
 </settings>
diff --git a/src/ArchiveConfig.cpp b/src/ArchiveConfig.cpp
new file mode 100644
index 0000000..e4a7c24
--- /dev/null
+++ b/src/ArchiveConfig.cpp
@@ -0,0 +1,144 @@
+/*
+ *      Copyright (C) 2018-now Arthur Liberman
+ *
+ *  This Program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2, or (at your option)
+ *  any later version.
+ *
+ *  This Program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with XBMC; see the file COPYING.  If not, write to
+ *  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+ *  http://www.gnu.org/copyleft/gpl.html
+ *
+ */
+
+#include <string>
+#include <ctime>
+
+#include "ArchiveConfig.h"
+
+using namespace ADDON;
+
+void CArchiveConfig::ReadSettings(CHelper_libXBMC_addon *XBMC)
+{
+    m_XBMC = XBMC;
+    if (!XBMC->GetSetting("archEnable", &m_bIsEnabled))
+    {
+        m_bIsEnabled = false;
+    }
+    char buffer[1024];
+    if (XBMC->GetSetting("archUrlFormat", &buffer))
+    {
+        m_sUrlFormat = std::string(buffer);
+    }
+    else
+    {
+        m_bIsEnabled = false;
+    }
+    int temp = 0;
+    if (XBMC->GetSetting("archTimeshiftBuffer", &temp))
+    {
+        m_tTimeshiftBuffer = static_cast<time_t>(++temp) * 24*60*60;
+    }
+    else
+    {
+        m_tTimeshiftBuffer = 24*60*60;    // Default to 1 day.
+    }
+    if (XBMC->GetSetting("archBeginBuffer", &temp))
+    {
+        m_tEpgBeginBuffer = GetEpgBufferFromSettings(temp);
+    }
+    else
+    {
+        m_tEpgBeginBuffer = 5*60;         // Default to 5 minutes.
+    }
+    if (XBMC->GetSetting("archEndBuffer", &temp))
+    {
+        m_tEpgEndBuffer = GetEpgBufferFromSettings(temp);
+    }
+    else
+    {
+        m_tEpgEndBuffer = 15*60;         // Default to 15 minutes.
+    }
+    if (!XBMC->GetSetting("archPlayEpgAsLive", &m_bPlayEpgAsLive))
+    {
+        m_bPlayEpgAsLive = false;
+    }
+}
+
+std::string CArchiveConfig::FormatDateTime(time_t dateTimeEpg, const std::string &url) const
+{
+    const time_t dateTimeNow = std::time(0);
+    struct tm dateTime = {0};
+    localtime_r(&dateTimeEpg, &dateTime);
+    std::string fmt = (url + m_sUrlFormat);
+    FormatTime('Y', &dateTime, fmt);
+    FormatTime('m', &dateTime, fmt);
+    FormatTime('d', &dateTime, fmt);
+    FormatTime('H', &dateTime, fmt);
+    FormatTime('M', &dateTime, fmt);
+    FormatTime('S', &dateTime, fmt);
+    FormatUtc("{utc}", dateTimeEpg, fmt);
+    FormatUtc("${start}", dateTimeEpg, fmt);
+    FormatUtc("{lutc}", dateTimeNow, fmt);
+    m_XBMC->Log(LOG_DEBUG, "CArchiveConfig::FormatDateTime - \"%s\"", fmt.c_str());
+    return fmt;
+}
+
+void CArchiveConfig::FormatTime(const char ch, const struct tm *pTime, std::string &fmt) const
+{
+    char str[] = { '{', ch, '}', 0 };
+    auto pos = fmt.find(str);
+    if (pos != std::string::npos)
+    {
+        char buff[256], timeFmt[3];
+        snprintf(timeFmt, sizeof(timeFmt), "%%%c", ch);
+        strftime(buff, sizeof(buff), timeFmt, pTime);
+        if (strlen(buff) > 0)
+            fmt.replace(pos, 3, buff);
+    }
+}
+
+void CArchiveConfig::FormatUtc(const char *str, time_t tTime, std::string &fmt) const
+{
+    auto pos = fmt.find(str);
+    if (pos != std::string::npos)
+    {
+        char buff[256];
+        snprintf(buff, sizeof(buff), "%lu", tTime);
+        fmt.replace(pos, strlen(str), buff);
+    }
+}
+
+time_t CArchiveConfig::GetEpgBufferFromSettings(int setting) const
+{
+    time_t minutes = 0;
+    switch (setting)
+    {
+        case 1:
+            minutes = 2;
+        break;
+        case 2:
+            minutes = 5;
+        break;
+        case 3:
+            minutes = 10;
+        break;
+        case 4:
+            minutes = 15;
+        break;
+        case 5:
+            minutes = 30;
+        break;
+        case 6:
+            minutes = 60;
+        break;
+    }
+    return minutes * 60;
+}
diff --git a/src/ArchiveConfig.h b/src/ArchiveConfig.h
new file mode 100644
index 0000000..0aa8ff8
--- /dev/null
+++ b/src/ArchiveConfig.h
@@ -0,0 +1,52 @@
+#pragma once
+/*
+ *      Copyright (C) 2018-now Arthur Liberman
+ *
+ *  This Program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License as published by
+ *  the Free Software Foundation; either version 2, or (at your option)
+ *  any later version.
+ *
+ *  This Program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+ *  GNU General Public License for more details.
+ *
+ *  You should have received a copy of the GNU General Public License
+ *  along with XBMC; see the file COPYING.  If not, write to
+ *  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
+ *  http://www.gnu.org/copyleft/gpl.html
+ *
+ */
+
+#include <algorithm>
+
+#include "p8-platform/os.h"
+#include "libXBMC_addon.h"
+
+class CArchiveConfig
+{
+public:
+    void        ReadSettings(ADDON::CHelper_libXBMC_addon *XBMC);
+    bool        IsEnabled() const { return m_bIsEnabled; }
+    std::string FormatDateTime(time_t epgTime, const std::string &url) const;
+    std::string GetArchiveUrlFormat() const { return m_sUrlFormat; }
+    time_t      GetTimeshiftBuffer() const { return std::max(static_cast<time_t>(0), m_tTimeshiftBuffer); }
+    time_t      GetEpgBeginBuffer() const { return std::max(static_cast<time_t>(0), m_tEpgBeginBuffer); }
+    time_t      GetEpgEndBuffer() const { return std::max(static_cast<time_t>(0), m_tEpgEndBuffer); }
+    bool        GetPlayEpgAsLive() const { return m_bPlayEpgAsLive; }
+
+private:
+    time_t      GetEpgBufferFromSettings(int setting) const;
+    void        FormatTime(const char ch, const struct tm *pTime, std::string &fmt) const;
+    void        FormatUtc(const char *str, time_t tTime, std::string &fmt) const;
+
+    bool        m_bIsEnabled = false;
+    std::string m_sUrlFormat;
+    time_t      m_tTimeshiftBuffer = -1;
+    time_t      m_tEpgBeginBuffer = -1;
+    time_t      m_tEpgEndBuffer = -1;
+    bool        m_bPlayEpgAsLive = false;
+
+    ADDON::CHelper_libXBMC_addon *m_XBMC = nullptr;
+};
diff --git a/src/PVRIptvData.cpp b/src/PVRIptvData.cpp
index 0d79561..c834d94 100644
--- a/src/PVRIptvData.cpp
+++ b/src/PVRIptvData.cpp
@@ -39,6 +39,7 @@
 #include "PVRIptvData.h"
 #include "p8-platform/util/StringUtils.h"
 #include "client.h"
+#include "ArchiveConfig.h"
 
 #define M3U_START_MARKER        "#EXTM3U"
 #define M3U_GROUP_MARKER        "#EXTGRP:"
@@ -50,6 +51,8 @@
 #define TVG_INFO_SHIFT_MARKER   "tvg-shift="
 #define TVG_INFO_CHNO_MARKER    "tvg-chno="
 #define GROUP_NAME_MARKER       "group-title="
+#define CATCHUP_SOURCE          "catchup-source="
+#define CATCHUP_DAYS            "catchup-days="
 #define KODIPROP_MARKER         "#KODIPROP:"
 #define EXTVLCOPT_MARKER        "#EXTVLCOPT:"
 #define RADIO_MARKER            "radio="
@@ -63,6 +66,8 @@
 using namespace ADDON;
 using namespace rapidxml;
 
+extern CArchiveConfig g_ArchiveConfig;
+
 template<class Ch>
 inline bool GetNodeValue(const xml_node<Ch> * pRootNode, const char* strTag, std::string& strStringValue)
 {
@@ -206,6 +211,7 @@ PVRIptvData::PVRIptvData(void)
   m_iLastStart    = 0;
   m_iLastEnd      = 0;
 
+  m_iEpgUrlTimeOffset = 0;
   m_channels.clear();
   m_groups.clear();
   m_epg.clear();
@@ -604,12 +610,11 @@ bool PVRIptvData::LoadPlayList(void)
   std::vector<int> iCurrentGroupId;
   std::string iChannelGroupName = "";
 
-  PVRIptvChannel tmpChannel;
+  PVRIptvChannel tmpChannel = {0};
   tmpChannel.strTvgId       = "";
   tmpChannel.strChannelName = "";
   tmpChannel.strTvgName     = "";
   tmpChannel.strTvgLogo     = "";
-  tmpChannel.iTvgShift      = 0;
 
   std::string strLine;
   while(std::getline(stream, strLine))
@@ -657,6 +662,8 @@ bool PVRIptvData::LoadPlayList(void)
       std::string strTvgShift  = "";
       std::string strGroupName = "";
       std::string strRadio     = "";
+      std::string strCatchupSource = "";
+      std::string strCatchupDays   = "";
 
       iCurrentGroupId.clear();
       bRadio = false;
@@ -684,6 +691,8 @@ bool PVRIptvData::LoadPlayList(void)
         strGroupName  = ReadMarkerValue(strInfoLine, GROUP_NAME_MARKER);
         strRadio      = ReadMarkerValue(strInfoLine, RADIO_MARKER);
         strTvgShift   = ReadMarkerValue(strInfoLine, TVG_INFO_SHIFT_MARKER);
+        strCatchupSource = ReadMarkerValue(strInfoLine, CATCHUP_SOURCE);
+        strCatchupDays   = ReadMarkerValue(strInfoLine, CATCHUP_DAYS);
 
         if (strTvgId.empty())
           strTvgId = ReadMarkerValue(strInfoLine, TVG_INFO_ID_MARKER_UC);
@@ -710,6 +719,7 @@ bool PVRIptvData::LoadPlayList(void)
         tmpChannel.strTvgId   = strTvgId;
         tmpChannel.strTvgName = XBMC->UnknownToUTF8(strTvgName.c_str());
         tmpChannel.strTvgLogo = XBMC->UnknownToUTF8(strTvgLogo.c_str());
+        tmpChannel.strCatchupSource = XBMC->UnknownToUTF8(strCatchupSource.c_str());
         tmpChannel.iTvgShift  = (int)(fTvgShift * 3600.0);
         tmpChannel.bRadio     = bRadio;
 
@@ -727,6 +737,11 @@ bool PVRIptvData::LoadPlayList(void)
           tmpChannel.iTvgShift = iEPGTimeShift;
         }
 
+        if (!strCatchupDays.empty())
+        {
+          tmpChannel.iCatchupLength = 24 * 60 * 60 * atoi(strCatchupDays.c_str());
+        }
+
         iChannelGroupName = strGroupName;
         ProcessGroupLine(strGroupName, bRadio, iCurrentGroupId);
       }
@@ -802,9 +817,19 @@ bool PVRIptvData::LoadPlayList(void)
         channel.strStreamURL = strLine;
       }
       
-      channel.strGroupName = iChannelGroupName;
+      channel.strCatchupSource  = tmpChannel.strCatchupSource;
+      channel.strGroupName      = iChannelGroupName;
       channel.iEncryptionSystem = 0;
 
+      if (tmpChannel.iCatchupLength != 0)
+      {
+        channel.iCatchupLength = tmpChannel.iCatchupLength;
+      }
+      else
+      {
+        channel.iCatchupLength = g_ArchiveConfig.GetTimeshiftBuffer();
+      }
+
       iChannelNum++;
 
       for (auto it = iCurrentGroupId.begin(); it != iCurrentGroupId.end(); ++it)
@@ -962,6 +987,7 @@ PVR_ERROR PVRIptvData::GetChannels(ADDON_HANDLE handle, bool bRadio)
       xbmcChannel.iEncryptionSystem = channel.iEncryptionSystem;
       strncpy(xbmcChannel.strIconPath, channel.strLogoPath.c_str(), sizeof(xbmcChannel.strIconPath) - 1);
       xbmcChannel.bIsHidden         = false;
+      xbmcChannel.bHasArchive       = IsArchiveSupportedOnChannel(channel);
 
       PVR->TransferChannelEntry(handle, &xbmcChannel);
     }
@@ -971,12 +997,27 @@ PVR_ERROR PVRIptvData::GetChannels(ADDON_HANDLE handle, bool bRadio)
 }
 
 bool PVRIptvData::GetChannel(const PVR_CHANNEL &channel, PVRIptvChannel &myChannel)
+{
+  return GetChannel((int)channel.iUniqueId, myChannel);
+}
+
+bool PVRIptvData::GetChannel(const EPG_TAG *tag, PVRIptvChannel &myChannel)
+{
+  if (tag && GetChannel((int)tag->iUniqueChannelId, myChannel))
+  {
+    myChannel.epgTag = *tag;
+    return true;
+  }
+  return false;
+}
+
+bool PVRIptvData::GetChannel(int uniqueId, PVRIptvChannel &myChannel)
 {
   P8PLATFORM::CLockObject lock(m_mutex);
   for (unsigned int iChannelPtr = 0; iChannelPtr < m_channels.size(); iChannelPtr++)
   {
     PVRIptvChannel &thisChannel = m_channels.at(iChannelPtr);
-    if (thisChannel.iUniqueId == (int) channel.iUniqueId)
+    if (thisChannel.iUniqueId == uniqueId)
     {
       myChannel.iUniqueId         = thisChannel.iUniqueId;
       myChannel.bRadio            = thisChannel.bRadio;
@@ -985,8 +1026,12 @@ bool PVRIptvData::GetChannel(const PVR_CHANNEL &channel, PVRIptvChannel &myChann
       myChannel.strChannelName    = thisChannel.strChannelName;
       myChannel.strLogoPath       = thisChannel.strLogoPath;
       myChannel.strStreamURL      = thisChannel.strStreamURL;
+      myChannel.strCatchupSource  = thisChannel.strCatchupSource;
+      myChannel.iCatchupLength    = thisChannel.iCatchupLength;
+      myChannel.strGroupName      = thisChannel.strGroupName;
       myChannel.properties        = thisChannel.properties;
-
+      if (!GetLiveEPGTag(myChannel, myChannel.epgTag, true))
+        myChannel.epgTag          = {0};
       return true;
     }
   }
@@ -1049,6 +1094,49 @@ PVR_ERROR PVRIptvData::GetChannelGroupMembers(ADDON_HANDLE handle, const PVR_CHA
   return PVR_ERROR_NO_ERROR;
 }
 
+void PVRIptvData::FillEPGTag(const PVRIptvEpgEntry *epgEntry, const PVRIptvChannel &channel, int shift, EPG_TAG &tag)
+{
+  int iGenreType, iGenreSubType;
+
+  memset(&tag, 0, sizeof(EPG_TAG));
+
+  tag.iUniqueBroadcastId  = epgEntry->iBroadcastId;
+  tag.strTitle            = epgEntry->strTitle.c_str();
+  tag.iUniqueChannelId    = channel.iUniqueId;
+  tag.startTime           = epgEntry->startTime + shift;
+  tag.endTime             = epgEntry->endTime + shift;
+  tag.strPlotOutline      = epgEntry->strPlotOutline.c_str();
+  tag.strPlot             = epgEntry->strPlot.c_str();
+  tag.strOriginalTitle    = NULL;  /* not supported */
+  tag.strCast             = epgEntry->strCast.c_str();
+  tag.strDirector         = epgEntry->strDirector.c_str();
+  tag.strWriter           = epgEntry->strWriter.c_str();
+  tag.iYear               = epgEntry->iYear;
+  tag.strIMDBNumber       = NULL;  /* not supported */
+  tag.strIconPath         = epgEntry->strIconPath.c_str();
+  if (FindEpgGenre(epgEntry->strGenreString, iGenreType, iGenreSubType))
+  {
+    tag.iGenreType          = iGenreType;
+    tag.iGenreSubType       = iGenreSubType;
+    tag.strGenreDescription = NULL;
+  }
+  else
+  {
+    tag.iGenreType          = EPG_GENRE_USE_STRING;
+    tag.iGenreSubType       = 0;     /* not supported */
+    tag.strGenreDescription = epgEntry->strGenreString.c_str();
+  }
+  tag.iParentalRating     = 0;     /* not supported */
+  tag.iStarRating         = epgEntry->iStarRating;
+  tag.bNotify             = false; /* not supported */
+  tag.iSeriesNumber       = epgEntry->iSeasonNumber;
+  tag.iEpisodeNumber      = epgEntry->iEpisodeNumber;
+  tag.iEpisodePartNumber  = epgEntry->iEpisodePartNumber;
+  tag.strEpisodeName      = epgEntry->strEpisodeName.c_str();
+  tag.iFlags              = EPG_TAG_FLAG_UNDEFINED;
+  tag.firstAired          = epgEntry->firstAired;
+}
+
 PVR_ERROR PVRIptvData::GetEPGForChannel(ADDON_HANDLE handle, const PVR_CHANNEL &channel, time_t iStart, time_t iEnd)
 {
   P8PLATFORM::CLockObject lock(m_mutex);
@@ -1081,46 +1169,8 @@ PVR_ERROR PVRIptvData::GetEPGForChannel(ADDON_HANDLE handle, const PVR_CHANNEL &
       if ((myTag->endTime + iShift) < iStart)
         continue;
 
-      int iGenreType, iGenreSubType;
-
       EPG_TAG tag;
-      memset(&tag, 0, sizeof(EPG_TAG));
-
-      tag.iUniqueBroadcastId  = myTag->iBroadcastId;
-      tag.strTitle            = myTag->strTitle.c_str();
-      tag.iUniqueChannelId    = channel.iUniqueId;
-      tag.startTime           = myTag->startTime + iShift;
-      tag.endTime             = myTag->endTime + iShift;
-      tag.strPlotOutline      = myTag->strPlotOutline.c_str();
-      tag.strPlot             = myTag->strPlot.c_str();
-      tag.strOriginalTitle    = NULL;  /* not supported */
-      tag.strCast             = myTag->strCast.c_str();
-      tag.strDirector         = myTag->strDirector.c_str();
-      tag.strWriter           = myTag->strWriter.c_str();
-      tag.iYear               = myTag->iYear;
-      tag.strIMDBNumber       = NULL;  /* not supported */
-      tag.strIconPath         = myTag->strIconPath.c_str();
-      if (FindEpgGenre(myTag->strGenreString, iGenreType, iGenreSubType))
-      {
-        tag.iGenreType          = iGenreType;
-        tag.iGenreSubType       = iGenreSubType;
-        tag.strGenreDescription = NULL;
-      }
-      else
-      {
-        tag.iGenreType          = EPG_GENRE_USE_STRING;
-        tag.iGenreSubType       = 0;     /* not supported */
-        tag.strGenreDescription = myTag->strGenreString.c_str();
-      }
-      tag.iParentalRating     = 0;     /* not supported */
-      tag.iStarRating         = myTag->iStarRating;
-      tag.bNotify             = false; /* not supported */
-      tag.iSeriesNumber       = myTag->iSeasonNumber;
-      tag.iEpisodeNumber      = myTag->iEpisodeNumber;
-      tag.iEpisodePartNumber  = myTag->iEpisodePartNumber;
-      tag.strEpisodeName      = myTag->strEpisodeName.c_str();
-      tag.iFlags              = EPG_TAG_FLAG_UNDEFINED;
-      tag.firstAired          = myTag->firstAired;
+      FillEPGTag(std::addressof(*myTag), *myChannel, iShift, tag);
 
       PVR->TransferEpgEntry(handle, &tag);
 
@@ -1212,7 +1262,7 @@ PVRIptvEpgChannel* PVRIptvData::FindEpgForChannel(const std::string& id)
   return nullptr;
 }
 
-PVRIptvEpgChannel * PVRIptvData::FindEpgForChannel(PVRIptvChannel &channel)
+PVRIptvEpgChannel * PVRIptvData::FindEpgForChannel(const PVRIptvChannel &channel)
 {
   for (auto& epgChannel : m_epg)
   {
@@ -1532,3 +1582,84 @@ std::string PVRIptvData::AddHeaderToStreamUrl (const std::string& url, const std
 
   return url + separator + header + '=' + value;
 }
+
+std::string PVRIptvData::GetEpgTagUrl(const EPG_TAG *tag, PVRIptvChannel &myChannel)
+{
+  std::string strUrl;
+
+  if (!tag && myChannel.epgTag.startTime > 0)
+    return BuildEpgTagUrl(&myChannel.epgTag, myChannel);
+  else if (!tag)
+    return strUrl;
+
+  std::vector<PVRIptvChannel>::iterator channel;
+  for (channel = m_channels.begin(); channel < m_channels.end(); ++channel)
+  {
+    if (channel->iUniqueId != (int) tag->iUniqueChannelId)
+      continue;
+
+    myChannel = *channel;
+    myChannel.epgTag = *tag;
+    strUrl = BuildEpgTagUrl(tag, myChannel);
+    break;
+  }
+
+  return strUrl;
+}
+
+std::string PVRIptvData::BuildEpgTagUrl(const EPG_TAG *tag, const PVRIptvChannel &channel)
+{
+    std::string startTimeUrl;
+    time_t timeNow = time(0);
+    time_t offset = tag->startTime + m_iEpgUrlTimeOffset;
+    if (tag->startTime > 0 && offset < timeNow - 5)
+      startTimeUrl = g_ArchiveConfig.FormatDateTime(offset - channel.iTvgShift,
+                      !channel.strCatchupSource.empty() ? channel.strCatchupSource : channel.strStreamURL);
+    else
+      startTimeUrl = channel.strStreamURL;
+    return startTimeUrl;
+}
+
+bool PVRIptvData::GetLiveEPGTag(const PVRIptvChannel &myChannel, EPG_TAG &tag, bool addTvgShift)
+{
+  bool ret = false;
+  PVRIptvEpgChannel *epg;
+  if ((epg = FindEpgForChannel(myChannel)) == NULL || epg->epg.size() == 0)
+    return ret;
+
+  int iShift = m_bTSOverride ? m_iEPGTimeShift : myChannel.iTvgShift + m_iEPGTimeShift;
+
+  time_t dateTimeNow = time(0);
+  std::vector<PVRIptvEpgEntry>::iterator myTag;
+  for (myTag = epg->epg.begin(); myTag < epg->epg.end(); ++myTag)
+  {
+    time_t startTime = myTag->startTime + iShift;
+    time_t endTime = myTag->endTime + iShift;
+    if (startTime <= dateTimeNow && endTime > dateTimeNow)
+    {
+      FillEPGTag(std::addressof(*myTag), myChannel, iShift, tag);
+      ret = true;
+      break;
+    }
+    else if (startTime > dateTimeNow)
+    {
+      break;
+    }
+  }
+
+  return ret;
+}
+
+bool PVRIptvData::IsArchiveSupportedOnChannel(const PVRIptvChannel &channel)
+{
+  return !(g_ArchiveConfig.GetArchiveUrlFormat().empty() && channel.strCatchupSource.empty());
+}
+
+bool PVRIptvData::IsArchiveSupportedOnChannel(int uniqueId)
+{
+  bool ret = !g_ArchiveConfig.GetArchiveUrlFormat().empty();
+  PVRIptvChannel channel = {0};
+  if (!ret && GetChannel(uniqueId, channel))
+    ret = !channel.strCatchupSource.empty();
+  return ret;
+}
diff --git a/src/PVRIptvData.h b/src/PVRIptvData.h
index 94e2eb0..9e513d5 100644
--- a/src/PVRIptvData.h
+++ b/src/PVRIptvData.h
@@ -29,6 +29,8 @@
 #include "kodi/libXBMC_pvr.h"
 #include "p8-platform/threads/threads.h"
 
+#define DVD_TIME_BASE 1000000
+
 struct PVRIptvEpgEntry
 {
   int         iBroadcastId;
@@ -72,11 +74,15 @@ struct PVRIptvChannel
   std::string strChannelName;
   std::string strLogoPath;
   std::string strStreamURL;
+  std::string strCatchupSource;
   std::string strGroupName;
   std::string strTvgId;
   std::string strTvgName;
   std::string strTvgLogo;
   std::map<std::string, std::string> properties;
+  EPG_TAG     epgTag;
+  int         iCatchupLength;
+  time_t      timeshiftStartTime;
 };
 
 struct PVRIptvChannelGroup
@@ -102,6 +108,8 @@ public:
 
   virtual int       GetChannelsAmount(void);
   virtual PVR_ERROR GetChannels(ADDON_HANDLE handle, bool bRadio);
+  virtual bool      GetChannel(int uniqueId, PVRIptvChannel &myChannel);
+  virtual bool      GetChannel(const EPG_TAG *tag, PVRIptvChannel &myChannel);
   virtual bool      GetChannel(const PVR_CHANNEL &channel, PVRIptvChannel &myChannel);
   virtual int       GetChannelGroupsAmount(void);
   virtual PVR_ERROR GetChannelGroups(ADDON_HANDLE handle, bool bRadio);
@@ -110,6 +118,12 @@ public:
   virtual void      ReaplyChannelsLogos(const char * strNewPath);
   virtual void      ReloadPlayList(const char * strNewPath);
   virtual void      ReloadEPG(const char * strNewPath);
+  virtual std::string GetEpgTagUrl(const EPG_TAG *tag, PVRIptvChannel &myChannel);
+  virtual long long GetEpgUrlTimeOffset(void) { return m_iEpgUrlTimeOffset; }
+  virtual void      SetEpgUrlTimeOffset(long long offset) { m_iEpgUrlTimeOffset = offset; }
+  virtual bool      GetLiveEPGTag(const PVRIptvChannel &myChannel, EPG_TAG &tag, bool addTvgShift);
+  virtual bool      IsArchiveSupportedOnChannel(const PVRIptvChannel &channel);
+  virtual bool      IsArchiveSupportedOnChannel(int uniqueId);
 
 protected:
   virtual bool                 LoadPlayList(void);
@@ -120,7 +134,7 @@ protected:
   virtual PVRIptvChannelGroup* FindGroup(const std::string &strName);
   virtual PVRIptvEpgChannel*   FindEpg(const std::string &strId);
   PVRIptvEpgChannel* FindEpgForChannel(const std::string& id);
-  virtual PVRIptvEpgChannel*   FindEpgForChannel(PVRIptvChannel &channel);
+  virtual PVRIptvEpgChannel*   FindEpgForChannel(const PVRIptvChannel &channel);
   virtual bool                 FindEpgGenre(const std::string& strGenre, int& iType, int& iSubType);
   virtual bool                 GzipInflate(const std::string &compressedBytes, std::string &uncompressedBytes);
   virtual int                  GetCachedFileContents(const std::string &strCachedName, const std::string &strFilePath,
@@ -133,6 +147,8 @@ protected:
 
 protected:
   virtual void *Process(void);
+  virtual std::string BuildEpgTagUrl(const EPG_TAG *tag, const PVRIptvChannel &channel);
+  virtual void FillEPGTag(const PVRIptvEpgEntry *epgEntry, const PVRIptvChannel &channel, int shift, EPG_TAG &tag);
 
 private:
   static bool ParseEpisodeNumberInfo(const std::vector<std::pair<std::string, std::string>>& episodeNumbersList, PVRIptvEpgEntry& entry);
@@ -154,4 +170,6 @@ private:
   std::vector<PVRIptvEpgChannel>    m_epg;
   std::vector<PVRIptvEpgGenre>      m_genres;
   P8PLATFORM::CMutex                m_mutex;
+
+  long long                         m_iEpgUrlTimeOffset;
 };
diff --git a/src/client.cpp b/src/client.cpp
index 6931295..c6acdae 100644
--- a/src/client.cpp
+++ b/src/client.cpp
@@ -23,6 +23,7 @@
  */
 
 #include "client.h"
+#include "ArchiveConfig.h"
 #include "kodi/xbmc_pvr_dll.h"
 #include "PVRIptvData.h"
 #include "p8-platform/util/util.h"
@@ -42,7 +43,7 @@ using namespace ADDON;
 bool           m_bCreated       = false;
 ADDON_STATUS   m_CurStatus      = ADDON_STATUS_UNKNOWN;
 PVRIptvData   *m_data           = NULL;
-PVRIptvChannel m_currentChannel;
+PVRIptvChannel m_currentChannel = {0};
 
 /* User adjustable settings are saved here.
  * Default values are defined inside client.h
@@ -66,6 +67,10 @@ bool        g_bCacheM3U     = false;
 bool        g_bCacheEPG     = false;
 int         g_iEPGLogos     = 0;
 
+bool        g_bIsArchive    = false;
+bool        g_bResetUrlOffset = false;
+CArchiveConfig g_ArchiveConfig;
+
 extern std::string PathCombine(const std::string &strPath, const std::string &strFileName)
 {
   std::string strResult = strPath;
@@ -175,6 +180,8 @@ void ADDON_ReadSettings(void)
   // Logos from EPG
   if (!XBMC->GetSetting("logoFromEpg", &g_iEPGLogos))
     g_iEPGLogos = 0;
+
+  g_ArchiveConfig.ReadSettings(XBMC);
 }
 
 ADDON_STATUS ADDON_Create(void* hdl, void* props)
@@ -201,7 +208,7 @@ ADDON_STATUS ADDON_Create(void* hdl, void* props)
     return ADDON_STATUS_PERMANENT_FAILURE;
   }
 
-  XBMC->Log(LOG_DEBUG, "%s - Creating the PVR IPTV Simple add-on", __FUNCTION__);
+  XBMC->Log(LOG_DEBUG, "%s - Creating the PVR IPTV Archive add-on", __FUNCTION__);
 
   m_CurStatus     = ADDON_STATUS_UNKNOWN;
   g_strUserPath   = pvrprops->strUserPath;
@@ -288,7 +295,7 @@ PVR_ERROR GetAddonCapabilities(PVR_ADDON_CAPABILITIES* pCapabilities)
 
 const char *GetBackendName(void)
 {
-  static const char *strBackendName = "IPTV Simple PVR Add-on";
+  static const char *strBackendName = "IPTV Archive PVR Add-on";
   return strBackendName;
 }
 
@@ -340,30 +347,52 @@ PVR_ERROR GetChannels(ADDON_HANDLE handle, bool bRadio)
   return PVR_ERROR_SERVER_ERROR;
 }
 
+void SetStreamProperty(PVR_NAMED_VALUE* properties, unsigned int* iPropertiesCount,std::string name, std::string value)
+{
+  strncpy(properties[*iPropertiesCount].strName, name.c_str(), sizeof(properties[*iPropertiesCount].strName) - 1);
+  strncpy(properties[*iPropertiesCount].strValue, value.c_str(), sizeof(properties[*iPropertiesCount].strValue) - 1);
+  (*iPropertiesCount)++;
+}
+
 PVR_ERROR GetChannelStreamProperties(const PVR_CHANNEL* channel, PVR_NAMED_VALUE* properties, unsigned int* iPropertiesCount)
 {
-  if (!channel || !properties || !iPropertiesCount)
+  if (!m_data || !channel || !properties || !iPropertiesCount)
     return PVR_ERROR_SERVER_ERROR;
 
   if (*iPropertiesCount < 1)
     return PVR_ERROR_INVALID_PARAMETERS;
 
-  if (m_data && m_data->GetChannel(*channel, m_currentChannel))
+  *iPropertiesCount = 0;
+  if (m_data->GetChannel(*channel, m_currentChannel))
   {
-    strncpy(properties[0].strName, PVR_STREAM_PROPERTY_STREAMURL, sizeof(properties[0].strName) - 1);
-    strncpy(properties[0].strValue, m_currentChannel.strStreamURL.c_str(), sizeof(properties[0].strValue) - 1);
-    *iPropertiesCount = 1;
-    if (!m_currentChannel.properties.empty())
+    g_bIsArchive = false;
+    if (g_bResetUrlOffset)
     {
-      for (auto& prop : m_currentChannel.properties)
+      g_bResetUrlOffset = false;
+      if (m_data->IsArchiveSupportedOnChannel(m_currentChannel))
+      {
+        m_data->SetEpgUrlTimeOffset(g_ArchiveConfig.GetTimeshiftBuffer());
+        m_currentChannel.timeshiftStartTime = time(0) - g_ArchiveConfig.GetTimeshiftBuffer();
+      }
+      else
       {
-        strncpy(properties[*iPropertiesCount].strName, prop.first.c_str(),
-                sizeof(properties[*iPropertiesCount].strName) - 1);
-        strncpy(properties[*iPropertiesCount].strValue, prop.second.c_str(),
-                sizeof(properties[*iPropertiesCount].strName) - 1);
-        (*iPropertiesCount)++;
+        m_data->SetEpgUrlTimeOffset(0);
+        m_currentChannel.timeshiftStartTime = 0;
       }
     }
+    m_currentChannel.epgTag.startTime = m_currentChannel.timeshiftStartTime;
+    std::string epgStrUrl = m_data->GetEpgTagUrl(nullptr, m_currentChannel);
+    if (!epgStrUrl.empty())
+      SetStreamProperty(properties, iPropertiesCount, PVR_STREAM_PROPERTY_STREAMURL, epgStrUrl.c_str());
+    else
+      SetStreamProperty(properties, iPropertiesCount, PVR_STREAM_PROPERTY_STREAMURL, m_currentChannel.strStreamURL.c_str());
+    if (!m_currentChannel.properties.empty())
+    {
+      for (auto& prop : m_currentChannel.properties)
+        SetStreamProperty(properties, iPropertiesCount, prop.first, prop.second);
+    }
+
+    XBMC->Log(LOG_DEBUG, "GetChannelStreamProperties - url: %s", properties[0].strValue);
     return PVR_ERROR_NO_ERROR;
   }
 
@@ -396,14 +425,160 @@ PVR_ERROR GetChannelGroupMembers(ADDON_HANDLE handle, const PVR_CHANNEL_GROUP &g
 
 PVR_ERROR SignalStatus(PVR_SIGNAL_STATUS &signalStatus)
 {
-  snprintf(signalStatus.strAdapterName, sizeof(signalStatus.strAdapterName), "IPTV Simple Adapter 1");
+  snprintf(signalStatus.strAdapterName, sizeof(signalStatus.strAdapterName), "IPTV Archive Adapter 1");
   snprintf(signalStatus.strAdapterStatus, sizeof(signalStatus.strAdapterStatus), "OK");
 
   return PVR_ERROR_NO_ERROR;
 }
 
+PVR_ERROR IsEPGTagPlayable(const EPG_TAG* tag, bool* bIsPlayable)
+{
+  if (!m_data)
+    return PVR_ERROR_SERVER_ERROR;
+
+  const time_t now = time(nullptr);
+  PVRIptvChannel channel;
+  *bIsPlayable = (g_ArchiveConfig.IsEnabled() && tag->startTime < now && m_data->GetChannel(tag, channel) &&
+    m_data->IsArchiveSupportedOnChannel(channel) && tag->startTime >= (now - static_cast<time_t>(channel.iCatchupLength)));
+  return PVR_ERROR_NO_ERROR;
+}
+
+PVR_ERROR GetEPGTagStreamProperties(const EPG_TAG* tag,
+    PVR_NAMED_VALUE* properties, unsigned int* iPropertiesCount)
+{
+  XBMC->Log(LOG_DEBUG, "GetEPGTagStreamProperties - Tag startTime: %ld \tendTime: %ld", tag->startTime, tag->endTime);
+
+  if (!m_data || !tag || !properties || !iPropertiesCount)
+    return PVR_ERROR_SERVER_ERROR;
+
+  if (*iPropertiesCount < 1)
+    return PVR_ERROR_INVALID_PARAMETERS;
+
+  *iPropertiesCount = 0;
+  XBMC->Log(LOG_DEBUG, "GetEPGTagStreamProperties - GetPlayEpgAsLive is %s",
+            g_ArchiveConfig.GetPlayEpgAsLive() ? "enabled" : "disabled");
+  if (g_ArchiveConfig.GetPlayEpgAsLive())
+  {
+    g_bResetUrlOffset = false;
+    m_data->GetEpgTagUrl(tag, m_currentChannel);
+    time_t timeNow = time(0);
+    time_t programOffset = timeNow - m_currentChannel.epgTag.startTime;
+    time_t timeshiftBuffer = std::max(programOffset, g_ArchiveConfig.GetTimeshiftBuffer());
+    m_currentChannel.timeshiftStartTime = timeNow - timeshiftBuffer;
+    m_currentChannel.epgTag.startTime = m_currentChannel.timeshiftStartTime;
+    m_currentChannel.epgTag.endTime = timeNow;
+    m_data->SetEpgUrlTimeOffset(timeshiftBuffer - programOffset);
+  }
+  else if (g_bResetUrlOffset)
+  {
+    g_bResetUrlOffset = false;
+    m_data->GetEpgTagUrl(tag, m_currentChannel);
+    const time_t beginBuffer = g_ArchiveConfig.GetEpgBeginBuffer();
+    const time_t endBuffer = g_ArchiveConfig.GetEpgEndBuffer();
+    m_currentChannel.timeshiftStartTime = m_currentChannel.epgTag.startTime - beginBuffer;
+    m_currentChannel.epgTag.startTime = m_currentChannel.timeshiftStartTime;
+    m_currentChannel.epgTag.endTime += endBuffer;
+    m_data->SetEpgUrlTimeOffset(beginBuffer);
+  }
+  std::string epgStrUrl = m_data->GetEpgTagUrl(nullptr, m_currentChannel);
+  if (!epgStrUrl.empty())
+  {
+    g_bIsArchive = true;
+    SetStreamProperty(properties, iPropertiesCount, PVR_STREAM_PROPERTY_STREAMURL, epgStrUrl.c_str());
+    if (!m_currentChannel.properties.empty())
+    {
+      for (auto& prop : m_currentChannel.properties)
+        SetStreamProperty(properties, iPropertiesCount, prop.first, prop.second);
+    }
+
+    XBMC->Log(LOG_DEBUG, "GetEPGTagStreamProperties - url: %s", epgStrUrl.c_str());
+    return g_ArchiveConfig.GetPlayEpgAsLive() ? PVR_ERROR_NOT_IMPLEMENTED : PVR_ERROR_NO_ERROR;
+  }
+
+  return PVR_ERROR_FAILED;
+}
+
+PVR_ERROR GetStreamTimes(PVR_STREAM_TIMES *times)
+{
+  if (!times)
+    return PVR_ERROR_INVALID_PARAMETERS;
+  if (!g_ArchiveConfig.IsEnabled() || m_currentChannel.timeshiftStartTime == 0)
+    return PVR_ERROR_NOT_IMPLEMENTED;
+
+  *times = {0};
+  const time_t dateTimeNow = time(0);
+  const EPG_TAG &epgTag = m_currentChannel.epgTag;
+  times->startTime = m_currentChannel.timeshiftStartTime;
+  if (g_bIsArchive)
+    times->ptsEnd = static_cast<int64_t>(std::min(dateTimeNow, epgTag.endTime) - times->startTime) * DVD_TIME_BASE;
+  else
+    times->ptsEnd = static_cast<int64_t>(dateTimeNow - times->startTime) * DVD_TIME_BASE;
+
+  XBMC->Log(LOG_DEBUG, "GetStreamTimes - Ch = %u \tTitle = \"%s\" \tepgTag->startTime = %ld \tepgTag->endTime = %ld",
+            m_currentChannel.epgTag.iUniqueChannelId, m_currentChannel.epgTag.strTitle, m_currentChannel.epgTag.startTime, m_currentChannel.epgTag.endTime);
+  XBMC->Log(LOG_DEBUG, "GetStreamTimes - startTime = %ld \tptsStart = %lld \tptsBegin = %lld \tptsEnd = %lld",
+            times->startTime, times->ptsStart, times->ptsBegin, times->ptsEnd);
+  return PVR_ERROR_NO_ERROR;
+}
+
+long long LengthLiveStream(void)
+{
+  long long ret = -1;
+  const EPG_TAG &epgTag = m_currentChannel.epgTag;
+  if (epgTag.startTime > 0 && epgTag.endTime >= epgTag.startTime)
+    ret = (epgTag.endTime - epgTag.startTime) * DVD_TIME_BASE;
+  return ret;
+}
+
+long long SeekLiveStream(long long iPosition, int iWhence /* = SEEK_SET */)
+{
+  long long ret = -1;
+  const EPG_TAG &epgTag = m_currentChannel.epgTag;
+  if (epgTag.startTime > 0)
+  {
+    XBMC->Log(LOG_DEBUG, "SeekLiveStream - iPosition = %lld, iWhence = %d", iPosition, iWhence);
+    const time_t timeNow = time(0);
+    switch (iWhence)
+    {
+      case SEEK_SET:
+      {
+        iPosition += 500;
+        iPosition /= 1000;
+        if (epgTag.startTime + iPosition < timeNow - 10)
+        {
+          ret = iPosition;
+          m_data->SetEpgUrlTimeOffset(iPosition);
+        }
+        else
+        {
+          ret = timeNow - epgTag.startTime;
+          m_data->SetEpgUrlTimeOffset(ret);
+        }
+        ret *= DVD_TIME_BASE;
+      }
+      break;
+      case SEEK_CUR:
+      {
+        long long offset = m_data->GetEpgUrlTimeOffset();
+        XBMC->Log(LOG_DEBUG, "SeekLiveStream - timeNow = %d, startTime = %d, iTvgShift = %d, offset = %d", timeNow, epgTag.startTime, m_currentChannel.iTvgShift, offset);
+        ret = offset * DVD_TIME_BASE;
+      }
+      break;
+      default:
+        XBMC->Log(LOG_NOTICE, "SeekLiveStream - Unsupported SEEK command (%d)", iWhence);
+      break;
+    }
+  }
+  return ret;
+}
+
+void CloseLiveStream(void)
+{
+  g_bResetUrlOffset = true;
+}
+
 /** UNUSED API FUNCTIONS */
-bool CanPauseStream(void) { return false; }
+bool CanPauseStream(void) { return true; }
 int GetRecordingsAmount(bool deleted) { return -1; }
 PVR_ERROR GetRecordings(ADDON_HANDLE handle, bool deleted) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR GetRecordingStreamProperties(const PVR_RECORDING*, PVR_NAMED_VALUE*, unsigned int*) { return PVR_ERROR_NOT_IMPLEMENTED; }
@@ -413,7 +588,6 @@ PVR_ERROR DeleteChannel(const PVR_CHANNEL &channel) { return PVR_ERROR_NOT_IMPLE
 PVR_ERROR RenameChannel(const PVR_CHANNEL &channel) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR OpenDialogChannelSettings(const PVR_CHANNEL &channel) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR OpenDialogChannelAdd(const PVR_CHANNEL &channel) { return PVR_ERROR_NOT_IMPLEMENTED; }
-void CloseLiveStream(void) { }
 bool OpenRecordedStream(const PVR_RECORDING &recording) { return false; }
 bool OpenLiveStream(const PVR_CHANNEL &channel) { return false; }
 void CloseRecordedStream(void) {}
@@ -423,8 +597,6 @@ long long LengthRecordedStream(void) { return 0; }
 void DemuxReset(void) {}
 void DemuxFlush(void) {}
 int ReadLiveStream(unsigned char *pBuffer, unsigned int iBufferSize) { return 0; }
-long long SeekLiveStream(long long iPosition, int iWhence /* = SEEK_SET */) { return -1; }
-long long LengthLiveStream(void) { return -1; }
 PVR_ERROR DeleteRecording(const PVR_RECORDING &recording) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR RenameRecording(const PVR_RECORDING &recording) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR SetRecordingPlayCount(const PVR_RECORDING &recording, int count) { return PVR_ERROR_NOT_IMPLEMENTED; }
@@ -442,7 +614,7 @@ DemuxPacket* DemuxRead(void) { return NULL; }
 bool IsTimeshifting(void) { return false; }
 bool IsRealTimeStream(void) { return true; }
 void PauseStream(bool bPaused) {}
-bool CanSeekStream(void) { return false; }
+bool CanSeekStream(void) { return true; }
 bool SeekTime(double,bool,double*) { return false; }
 void SetSpeed(int) {};
 PVR_ERROR UndeleteRecording(const PVR_RECORDING& recording) { return PVR_ERROR_NOT_IMPLEMENTED; }
@@ -450,11 +622,8 @@ PVR_ERROR DeleteAllRecordingsFromTrash() { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR SetEPGTimeFrame(int) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR GetDescrambleInfo(PVR_DESCRAMBLE_INFO*) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR SetRecordingLifetime(const PVR_RECORDING*) { return PVR_ERROR_NOT_IMPLEMENTED; }
-PVR_ERROR GetStreamTimes(PVR_STREAM_TIMES*) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR GetStreamProperties(PVR_STREAM_PROPERTIES*) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR IsEPGTagRecordable(const EPG_TAG*, bool*) { return PVR_ERROR_NOT_IMPLEMENTED; }
-PVR_ERROR IsEPGTagPlayable(const EPG_TAG*, bool*) { return PVR_ERROR_NOT_IMPLEMENTED; }
-PVR_ERROR GetEPGTagStreamProperties(const EPG_TAG*, PVR_NAMED_VALUE*, unsigned int*) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR GetEPGTagEdl(const EPG_TAG* epgTag, PVR_EDL_ENTRY edl[], int *size) { return PVR_ERROR_NOT_IMPLEMENTED; }
 PVR_ERROR GetStreamReadChunkSize(int* chunksize) { return PVR_ERROR_NOT_IMPLEMENTED; }
 
-- 
2.25.1


From 2c9acba5169da78b4870857f394929e502a3305e Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Sun, 17 Feb 2019 01:25:35 +0200
Subject: [PATCH 03/11] Replace bHasArchive with a different method to revert
 to old PVR API

---
 .gitignore          | 3 +++
 src/PVRIptvData.cpp | 3 ++-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/.gitignore b/.gitignore
index c9fb2cd..5d7f634 100644
--- a/.gitignore
+++ b/.gitignore
@@ -22,3 +22,6 @@ pvr.iptvsimple/addon.xml
 .cproject
 .project
 .settings/
+
+# vscode
+.vscode
diff --git a/src/PVRIptvData.cpp b/src/PVRIptvData.cpp
index c834d94..9c1310c 100644
--- a/src/PVRIptvData.cpp
+++ b/src/PVRIptvData.cpp
@@ -987,7 +987,8 @@ PVR_ERROR PVRIptvData::GetChannels(ADDON_HANDLE handle, bool bRadio)
       xbmcChannel.iEncryptionSystem = channel.iEncryptionSystem;
       strncpy(xbmcChannel.strIconPath, channel.strLogoPath.c_str(), sizeof(xbmcChannel.strIconPath) - 1);
       xbmcChannel.bIsHidden         = false;
-      xbmcChannel.bHasArchive       = IsArchiveSupportedOnChannel(channel);
+      if (IsArchiveSupportedOnChannel(channel))
+        strncpy(xbmcChannel.strInputFormat, "iptv/hasarchive", sizeof(xbmcChannel.strInputFormat) - 1);
 
       PVR->TransferChannelEntry(handle, &xbmcChannel);
     }
-- 
2.25.1


From 16fe9457213c5afb005ea4075bfccef57ac86c8c Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Sat, 1 Jun 2019 16:57:36 +0300
Subject: [PATCH 04/11] Add offset placeholder for archive

---
 src/ArchiveConfig.cpp | 29 +++++++++++++++++++++++++++++
 src/ArchiveConfig.h   |  1 +
 2 files changed, 30 insertions(+)

diff --git a/src/ArchiveConfig.cpp b/src/ArchiveConfig.cpp
index e4a7c24..7cb7c99 100644
--- a/src/ArchiveConfig.cpp
+++ b/src/ArchiveConfig.cpp
@@ -19,6 +19,7 @@
  */
 
 #include <string>
+#include <regex>
 #include <ctime>
 
 #include "ArchiveConfig.h"
@@ -87,6 +88,7 @@ std::string CArchiveConfig::FormatDateTime(time_t dateTimeEpg, const std::string
     FormatUtc("{utc}", dateTimeEpg, fmt);
     FormatUtc("${start}", dateTimeEpg, fmt);
     FormatUtc("{lutc}", dateTimeNow, fmt);
+    FormatOffset(dateTimeNow - dateTimeEpg, fmt);
     m_XBMC->Log(LOG_DEBUG, "CArchiveConfig::FormatDateTime - \"%s\"", fmt.c_str());
     return fmt;
 }
@@ -116,6 +118,33 @@ void CArchiveConfig::FormatUtc(const char *str, time_t tTime, std::string &fmt)
     }
 }
 
+void CArchiveConfig::FormatOffset(time_t tTime, std::string &fmt) const
+{
+    const std::string regexStr = ".*(\\{offset:(\\d+)\\}).*";
+    std::cmatch mr;
+    std::regex rx(regexStr);
+    if (std::regex_match(fmt.c_str(), mr, rx) && mr.length() >= 3)
+    {
+        std::string offsetExp = mr[1].first;
+        std::string second = mr[1].second;
+        if (second.length() > 0)
+            offsetExp = offsetExp.erase(offsetExp.find(second));
+        std::string dividerStr = mr[2].first;
+        second = mr[2].second;
+        if (second.length() > 0)
+            dividerStr = dividerStr.erase(dividerStr.find(second));
+
+        const time_t divider = stoi(dividerStr);
+        if (divider != 0)
+        {
+            time_t offset = tTime / divider;
+            if (offset < 0)
+                offset = 0;
+            fmt.replace(fmt.find(offsetExp), offsetExp.length(), std::to_string(offset));
+        }
+    }
+}
+
 time_t CArchiveConfig::GetEpgBufferFromSettings(int setting) const
 {
     time_t minutes = 0;
diff --git a/src/ArchiveConfig.h b/src/ArchiveConfig.h
index 0aa8ff8..b376a5f 100644
--- a/src/ArchiveConfig.h
+++ b/src/ArchiveConfig.h
@@ -40,6 +40,7 @@ private:
     time_t      GetEpgBufferFromSettings(int setting) const;
     void        FormatTime(const char ch, const struct tm *pTime, std::string &fmt) const;
     void        FormatUtc(const char *str, time_t tTime, std::string &fmt) const;
+    void        FormatOffset(time_t tTime, std::string &fmt) const;
 
     bool        m_bIsEnabled = false;
     std::string m_sUrlFormat;
-- 
2.25.1


From 2f594be634c5f456474d34f9fbdd60f86bf39241 Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Sat, 19 Oct 2019 03:21:14 +0300
Subject: [PATCH 05/11] Don't mark channels with archive support icon if
 archive is disabled

---
 src/ArchiveConfig.cpp | 4 ----
 src/PVRIptvData.cpp   | 8 +++++---
 2 files changed, 5 insertions(+), 7 deletions(-)

diff --git a/src/ArchiveConfig.cpp b/src/ArchiveConfig.cpp
index 7cb7c99..59e407f 100644
--- a/src/ArchiveConfig.cpp
+++ b/src/ArchiveConfig.cpp
@@ -38,10 +38,6 @@ void CArchiveConfig::ReadSettings(CHelper_libXBMC_addon *XBMC)
     {
         m_sUrlFormat = std::string(buffer);
     }
-    else
-    {
-        m_bIsEnabled = false;
-    }
     int temp = 0;
     if (XBMC->GetSetting("archTimeshiftBuffer", &temp))
     {
diff --git a/src/PVRIptvData.cpp b/src/PVRIptvData.cpp
index 9c1310c..6a09d53 100644
--- a/src/PVRIptvData.cpp
+++ b/src/PVRIptvData.cpp
@@ -987,8 +987,7 @@ PVR_ERROR PVRIptvData::GetChannels(ADDON_HANDLE handle, bool bRadio)
       xbmcChannel.iEncryptionSystem = channel.iEncryptionSystem;
       strncpy(xbmcChannel.strIconPath, channel.strLogoPath.c_str(), sizeof(xbmcChannel.strIconPath) - 1);
       xbmcChannel.bIsHidden         = false;
-      if (IsArchiveSupportedOnChannel(channel))
-        strncpy(xbmcChannel.strInputFormat, "iptv/hasarchive", sizeof(xbmcChannel.strInputFormat) - 1);
+      strncpy(xbmcChannel.strInputFormat, IsArchiveSupportedOnChannel(channel) ? "iptv/hasarchive" : "", sizeof(xbmcChannel.strInputFormat) - 1);
 
       PVR->TransferChannelEntry(handle, &xbmcChannel);
     }
@@ -1653,11 +1652,14 @@ bool PVRIptvData::GetLiveEPGTag(const PVRIptvChannel &myChannel, EPG_TAG &tag, b
 
 bool PVRIptvData::IsArchiveSupportedOnChannel(const PVRIptvChannel &channel)
 {
-  return !(g_ArchiveConfig.GetArchiveUrlFormat().empty() && channel.strCatchupSource.empty());
+  return g_ArchiveConfig.IsEnabled() && !(g_ArchiveConfig.GetArchiveUrlFormat().empty() && channel.strCatchupSource.empty());
 }
 
 bool PVRIptvData::IsArchiveSupportedOnChannel(int uniqueId)
 {
+  if (!g_ArchiveConfig.IsEnabled())
+    return false;
+
   bool ret = !g_ArchiveConfig.GetArchiveUrlFormat().empty();
   PVRIptvChannel channel = {0};
   if (!ret && GetChannel(uniqueId, channel))
-- 
2.25.1


From f9871fb12fb3e9c2f7cd4620451f11e4bb190c9d Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Fri, 13 Dec 2019 15:04:47 +0200
Subject: [PATCH 06/11] Improve Catchup support and support more placeholders

---
 src/ArchiveConfig.cpp |  4 ++-
 src/PVRIptvData.cpp   | 57 ++++++++++++++++++++++++++++++++++++++-----
 src/PVRIptvData.h     | 11 +++++++++
 3 files changed, 65 insertions(+), 7 deletions(-)

diff --git a/src/ArchiveConfig.cpp b/src/ArchiveConfig.cpp
index 59e407f..d6ae089 100644
--- a/src/ArchiveConfig.cpp
+++ b/src/ArchiveConfig.cpp
@@ -74,7 +74,7 @@ std::string CArchiveConfig::FormatDateTime(time_t dateTimeEpg, const std::string
     const time_t dateTimeNow = std::time(0);
     struct tm dateTime = {0};
     localtime_r(&dateTimeEpg, &dateTime);
-    std::string fmt = (url + m_sUrlFormat);
+    std::string fmt(url);
     FormatTime('Y', &dateTime, fmt);
     FormatTime('m', &dateTime, fmt);
     FormatTime('d', &dateTime, fmt);
@@ -84,6 +84,8 @@ std::string CArchiveConfig::FormatDateTime(time_t dateTimeEpg, const std::string
     FormatUtc("{utc}", dateTimeEpg, fmt);
     FormatUtc("${start}", dateTimeEpg, fmt);
     FormatUtc("{lutc}", dateTimeNow, fmt);
+    FormatUtc("${timestamp}", dateTimeNow, fmt);
+    FormatUtc("${offset}", dateTimeNow - dateTimeEpg, fmt);
     FormatOffset(dateTimeNow - dateTimeEpg, fmt);
     m_XBMC->Log(LOG_DEBUG, "CArchiveConfig::FormatDateTime - \"%s\"", fmt.c_str());
     return fmt;
diff --git a/src/PVRIptvData.cpp b/src/PVRIptvData.cpp
index 6a09d53..58ce38c 100644
--- a/src/PVRIptvData.cpp
+++ b/src/PVRIptvData.cpp
@@ -51,6 +51,7 @@
 #define TVG_INFO_SHIFT_MARKER   "tvg-shift="
 #define TVG_INFO_CHNO_MARKER    "tvg-chno="
 #define GROUP_NAME_MARKER       "group-title="
+#define CATCHUP_TYPE            "catchup="
 #define CATCHUP_SOURCE          "catchup-source="
 #define CATCHUP_DAYS            "catchup-days="
 #define KODIPROP_MARKER         "#KODIPROP:"
@@ -610,6 +611,10 @@ bool PVRIptvData::LoadPlayList(void)
   std::vector<int> iCurrentGroupId;
   std::string iChannelGroupName = "";
 
+  std::string globalStrCatchupType = "";
+  std::string globalStrCatchupSource = "";
+  std::string globalStrCatchupDays = "";
+
   PVRIptvChannel tmpChannel = {0};
   tmpChannel.strTvgId       = "";
   tmpChannel.strChannelName = "";
@@ -640,6 +645,10 @@ bool PVRIptvData::LoadPlayList(void)
       {
         double fTvgShift = atof(ReadMarkerValue(strLine, TVG_INFO_SHIFT_MARKER).c_str());
         iEPGTimeShift = (int) (fTvgShift * 3600.0);
+
+        globalStrCatchupType = ReadMarkerValue(strLine, CATCHUP_TYPE);
+        globalStrCatchupSource = ReadMarkerValue(strLine, CATCHUP_SOURCE);
+        globalStrCatchupDays = ReadMarkerValue(strLine, CATCHUP_DAYS);
         continue;
       }
       else
@@ -662,6 +671,7 @@ bool PVRIptvData::LoadPlayList(void)
       std::string strTvgShift  = "";
       std::string strGroupName = "";
       std::string strRadio     = "";
+      std::string strCatchupType   = "";
       std::string strCatchupSource = "";
       std::string strCatchupDays   = "";
 
@@ -691,6 +701,7 @@ bool PVRIptvData::LoadPlayList(void)
         strGroupName  = ReadMarkerValue(strInfoLine, GROUP_NAME_MARKER);
         strRadio      = ReadMarkerValue(strInfoLine, RADIO_MARKER);
         strTvgShift   = ReadMarkerValue(strInfoLine, TVG_INFO_SHIFT_MARKER);
+        strCatchupType = ReadMarkerValue(strInfoLine, CATCHUP_TYPE);
         strCatchupSource = ReadMarkerValue(strInfoLine, CATCHUP_SOURCE);
         strCatchupDays   = ReadMarkerValue(strInfoLine, CATCHUP_DAYS);
 
@@ -719,7 +730,7 @@ bool PVRIptvData::LoadPlayList(void)
         tmpChannel.strTvgId   = strTvgId;
         tmpChannel.strTvgName = XBMC->UnknownToUTF8(strTvgName.c_str());
         tmpChannel.strTvgLogo = XBMC->UnknownToUTF8(strTvgLogo.c_str());
-        tmpChannel.strCatchupSource = XBMC->UnknownToUTF8(strCatchupSource.c_str());
+        tmpChannel.strCatchupSource = !strCatchupSource.empty() ? strCatchupSource : globalStrCatchupSource;
         tmpChannel.iTvgShift  = (int)(fTvgShift * 3600.0);
         tmpChannel.bRadio     = bRadio;
 
@@ -737,11 +748,30 @@ bool PVRIptvData::LoadPlayList(void)
           tmpChannel.iTvgShift = iEPGTimeShift;
         }
 
+        if (strCatchupDays.empty())
+          strCatchupDays = globalStrCatchupDays;
+
         if (!strCatchupDays.empty())
         {
           tmpChannel.iCatchupLength = 24 * 60 * 60 * atoi(strCatchupDays.c_str());
         }
 
+        if (strCatchupType.empty())
+          strCatchupType = globalStrCatchupType;
+
+        if (strCatchupType == "append")
+          tmpChannel.catchupType = CATCHUP_APPEND;
+        else if (strCatchupType == "timeshift")
+          tmpChannel.catchupType = CATCHUP_TIMESHIFT;
+        else if (strCatchupType == "xc")
+          tmpChannel.catchupType = CATCHUP_XC;
+        else if (strCatchupType == "ez-ts")
+          tmpChannel.catchupType = CATCHUP_EZTS;
+        else if (strCatchupType == "fs")
+          tmpChannel.catchupType = CATCHUP_FS;
+        else
+          tmpChannel.catchupType = CATCHUP_DEFAULT;
+
         iChannelGroupName = strGroupName;
         ProcessGroupLine(strGroupName, bRadio, iCurrentGroupId);
       }
@@ -817,6 +847,7 @@ bool PVRIptvData::LoadPlayList(void)
         channel.strStreamURL = strLine;
       }
       
+      channel.catchupType       = tmpChannel.catchupType;
       channel.strCatchupSource  = tmpChannel.strCatchupSource;
       channel.strGroupName      = iChannelGroupName;
       channel.iEncryptionSystem = 0;
@@ -848,6 +879,9 @@ bool PVRIptvData::LoadPlayList(void)
       tmpChannel.iTvgShift      = 0;
       tmpChannel.bRadio         = false;
       tmpChannel.properties.clear();
+      tmpChannel.catchupType = CATCHUP_DEFAULT;
+      tmpChannel.strCatchupSource = "";
+      tmpChannel.iCatchupLength = 0;
       bIsRealTime = true;
     }
   }
@@ -1026,6 +1060,7 @@ bool PVRIptvData::GetChannel(int uniqueId, PVRIptvChannel &myChannel)
       myChannel.strChannelName    = thisChannel.strChannelName;
       myChannel.strLogoPath       = thisChannel.strLogoPath;
       myChannel.strStreamURL      = thisChannel.strStreamURL;
+      myChannel.catchupType       = thisChannel.catchupType;
       myChannel.strCatchupSource  = thisChannel.strCatchupSource;
       myChannel.iCatchupLength    = thisChannel.iCatchupLength;
       myChannel.strGroupName      = thisChannel.strGroupName;
@@ -1609,14 +1644,24 @@ std::string PVRIptvData::GetEpgTagUrl(const EPG_TAG *tag, PVRIptvChannel &myChan
 
 std::string PVRIptvData::BuildEpgTagUrl(const EPG_TAG *tag, const PVRIptvChannel &channel)
 {
-    std::string startTimeUrl;
+    std::string startTimeUrl = channel.strStreamURL;
     time_t timeNow = time(0);
     time_t offset = tag->startTime + m_iEpgUrlTimeOffset;
     if (tag->startTime > 0 && offset < timeNow - 5)
-      startTimeUrl = g_ArchiveConfig.FormatDateTime(offset - channel.iTvgShift,
-                      !channel.strCatchupSource.empty() ? channel.strCatchupSource : channel.strStreamURL);
-    else
-      startTimeUrl = channel.strStreamURL;
+    {
+      std::string urlTemplate;
+      switch (channel.catchupType)
+      {
+        case CATCHUP_APPEND:
+          urlTemplate = channel.strStreamURL + channel.strCatchupSource;
+          break;
+        case CATCHUP_DEFAULT:
+        default:
+          urlTemplate = g_ArchiveConfig.GetArchiveUrlFormat().empty() ? channel.strCatchupSource
+           : channel.strStreamURL + g_ArchiveConfig.GetArchiveUrlFormat();
+      }
+      startTimeUrl = g_ArchiveConfig.FormatDateTime(offset - channel.iTvgShift, urlTemplate);
+    }
     return startTimeUrl;
 }
 
diff --git a/src/PVRIptvData.h b/src/PVRIptvData.h
index 9e513d5..6d8868c 100644
--- a/src/PVRIptvData.h
+++ b/src/PVRIptvData.h
@@ -64,6 +64,16 @@ struct PVRIptvEpgChannel
   std::vector<PVRIptvEpgEntry> epg;
 };
 
+enum CatchupTypes
+{
+  CATCHUP_DEFAULT,
+  CATCHUP_APPEND,
+  CATCHUP_TIMESHIFT,
+  CATCHUP_XC,
+  CATCHUP_EZTS,
+  CATCHUP_FS,
+};
+
 struct PVRIptvChannel
 {
   bool        bRadio;
@@ -82,6 +92,7 @@ struct PVRIptvChannel
   std::map<std::string, std::string> properties;
   EPG_TAG     epgTag;
   int         iCatchupLength;
+  CatchupTypes catchupType;
   time_t      timeshiftStartTime;
 };
 
-- 
2.25.1


From 5f842d89d0cde0614ca3472d95dfe3b42903d36b Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Sat, 4 Apr 2020 18:08:30 +0300
Subject: [PATCH 07/11] Add timeshift catchup type support

---
 src/PVRIptvData.cpp | 33 ++++++++++++++++++++++++---------
 src/PVRIptvData.h   |  2 +-
 2 files changed, 25 insertions(+), 10 deletions(-)

diff --git a/src/PVRIptvData.cpp b/src/PVRIptvData.cpp
index 58ce38c..bb904a4 100644
--- a/src/PVRIptvData.cpp
+++ b/src/PVRIptvData.cpp
@@ -761,7 +761,7 @@ bool PVRIptvData::LoadPlayList(void)
 
         if (strCatchupType == "append")
           tmpChannel.catchupType = CATCHUP_APPEND;
-        else if (strCatchupType == "timeshift")
+        else if (strCatchupType == "shift" || strCatchupType == "timeshift")
           tmpChannel.catchupType = CATCHUP_TIMESHIFT;
         else if (strCatchupType == "xc")
           tmpChannel.catchupType = CATCHUP_XC;
@@ -1655,6 +1655,12 @@ std::string PVRIptvData::BuildEpgTagUrl(const EPG_TAG *tag, const PVRIptvChannel
         case CATCHUP_APPEND:
           urlTemplate = channel.strStreamURL + channel.strCatchupSource;
           break;
+        case CATCHUP_TIMESHIFT:
+          {
+            std::string querySep = (channel.strStreamURL.find("?") == std::string::npos) ? "?" : "&";
+            urlTemplate = channel.strStreamURL + querySep + "utc={utc}&lutc={lutc}";
+            break;
+          }
         case CATCHUP_DEFAULT:
         default:
           urlTemplate = g_ArchiveConfig.GetArchiveUrlFormat().empty() ? channel.strCatchupSource
@@ -1695,19 +1701,28 @@ bool PVRIptvData::GetLiveEPGTag(const PVRIptvChannel &myChannel, EPG_TAG &tag, b
   return ret;
 }
 
-bool PVRIptvData::IsArchiveSupportedOnChannel(const PVRIptvChannel &channel)
+bool PVRIptvData::IsArchiveSupportedOnChannel(int uniqueId)
 {
-  return g_ArchiveConfig.IsEnabled() && !(g_ArchiveConfig.GetArchiveUrlFormat().empty() && channel.strCatchupSource.empty());
+  if (!g_ArchiveConfig.IsEnabled())
+    return false;
+
+  PVRIptvChannel channel = {0};
+  return GetChannel(uniqueId, channel) && IsArchiveSupportedOnChannel(channel);
 }
 
-bool PVRIptvData::IsArchiveSupportedOnChannel(int uniqueId)
+bool PVRIptvData::IsArchiveSupportedOnChannel(const PVRIptvChannel &channel)
 {
   if (!g_ArchiveConfig.IsEnabled())
     return false;
 
-  bool ret = !g_ArchiveConfig.GetArchiveUrlFormat().empty();
-  PVRIptvChannel channel = {0};
-  if (!ret && GetChannel(uniqueId, channel))
-    ret = !channel.strCatchupSource.empty();
-  return ret;
+  switch (channel.catchupType)
+  {
+    case CATCHUP_APPEND:
+      return !channel.strCatchupSource.empty();
+    case CATCHUP_TIMESHIFT:
+      return true;
+    case CATCHUP_DEFAULT:
+    default:
+      return !g_ArchiveConfig.GetArchiveUrlFormat().empty() || !channel.strCatchupSource.empty();
+  }
 }
diff --git a/src/PVRIptvData.h b/src/PVRIptvData.h
index 6d8868c..245dfeb 100644
--- a/src/PVRIptvData.h
+++ b/src/PVRIptvData.h
@@ -133,8 +133,8 @@ public:
   virtual long long GetEpgUrlTimeOffset(void) { return m_iEpgUrlTimeOffset; }
   virtual void      SetEpgUrlTimeOffset(long long offset) { m_iEpgUrlTimeOffset = offset; }
   virtual bool      GetLiveEPGTag(const PVRIptvChannel &myChannel, EPG_TAG &tag, bool addTvgShift);
-  virtual bool      IsArchiveSupportedOnChannel(const PVRIptvChannel &channel);
   virtual bool      IsArchiveSupportedOnChannel(int uniqueId);
+  virtual bool      IsArchiveSupportedOnChannel(const PVRIptvChannel &channel);
 
 protected:
   virtual bool                 LoadPlayList(void);
-- 
2.25.1


From a541b71f8daea20465ff746281401863bb5cb533 Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Wed, 8 Apr 2020 17:51:22 +0300
Subject: [PATCH 08/11] Fix build archive url when user-agent is used

---
 src/PVRIptvData.cpp | 21 ++++++++++++++-------
 1 file changed, 14 insertions(+), 7 deletions(-)

diff --git a/src/PVRIptvData.cpp b/src/PVRIptvData.cpp
index bb904a4..3db21ea 100644
--- a/src/PVRIptvData.cpp
+++ b/src/PVRIptvData.cpp
@@ -1644,31 +1644,38 @@ std::string PVRIptvData::GetEpgTagUrl(const EPG_TAG *tag, PVRIptvChannel &myChan
 
 std::string PVRIptvData::BuildEpgTagUrl(const EPG_TAG *tag, const PVRIptvChannel &channel)
 {
-    std::string startTimeUrl = channel.strStreamURL;
+    std::string headers;
+    std::string streamUrl = channel.strStreamURL;
     time_t timeNow = time(0);
     time_t offset = tag->startTime + m_iEpgUrlTimeOffset;
+    std::size_t pos = streamUrl.find("|");
+    if (pos != std::string::npos)
+    {
+      headers = streamUrl.substr(pos);
+      streamUrl = streamUrl.substr(0, pos);
+    }
     if (tag->startTime > 0 && offset < timeNow - 5)
     {
       std::string urlTemplate;
       switch (channel.catchupType)
       {
         case CATCHUP_APPEND:
-          urlTemplate = channel.strStreamURL + channel.strCatchupSource;
+          urlTemplate = streamUrl + channel.strCatchupSource;
           break;
         case CATCHUP_TIMESHIFT:
           {
-            std::string querySep = (channel.strStreamURL.find("?") == std::string::npos) ? "?" : "&";
-            urlTemplate = channel.strStreamURL + querySep + "utc={utc}&lutc={lutc}";
+            std::string querySep = (streamUrl.find("?") == std::string::npos) ? "?" : "&";
+            urlTemplate = streamUrl + querySep + "utc={utc}&lutc={lutc}";
             break;
           }
         case CATCHUP_DEFAULT:
         default:
           urlTemplate = g_ArchiveConfig.GetArchiveUrlFormat().empty() ? channel.strCatchupSource
-           : channel.strStreamURL + g_ArchiveConfig.GetArchiveUrlFormat();
+           : streamUrl + g_ArchiveConfig.GetArchiveUrlFormat();
       }
-      startTimeUrl = g_ArchiveConfig.FormatDateTime(offset - channel.iTvgShift, urlTemplate);
+      streamUrl = g_ArchiveConfig.FormatDateTime(offset - channel.iTvgShift, urlTemplate);
     }
-    return startTimeUrl;
+    return streamUrl + headers;
 }
 
 bool PVRIptvData::GetLiveEPGTag(const PVRIptvChannel &myChannel, EPG_TAG &tag, bool addTvgShift)
-- 
2.25.1


From 8a35489be17368fb2f22b0b7a09960dd3a5081bd Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Fri, 19 Jun 2020 01:49:59 +0300
Subject: [PATCH 09/11] Add support for Flussonic and Flussonic catchup formats

---
 src/ArchiveConfig.cpp | 10 +++--
 src/ArchiveConfig.h   |  4 +-
 src/PVRIptvData.cpp   | 90 ++++++++++++++++++++++++++++++++++++++++++-
 src/PVRIptvData.h     |  2 +
 src/client.cpp        | 11 ++++--
 5 files changed, 107 insertions(+), 10 deletions(-)

diff --git a/src/ArchiveConfig.cpp b/src/ArchiveConfig.cpp
index d6ae089..e1243a1 100644
--- a/src/ArchiveConfig.cpp
+++ b/src/ArchiveConfig.cpp
@@ -69,7 +69,7 @@ void CArchiveConfig::ReadSettings(CHelper_libXBMC_addon *XBMC)
     }
 }
 
-std::string CArchiveConfig::FormatDateTime(time_t dateTimeEpg, const std::string &url) const
+std::string CArchiveConfig::FormatDateTime(time_t dateTimeEpg, time_t duration, const std::string &url) const
 {
     const time_t dateTimeNow = std::time(0);
     struct tm dateTime = {0};
@@ -86,7 +86,9 @@ std::string CArchiveConfig::FormatDateTime(time_t dateTimeEpg, const std::string
     FormatUtc("{lutc}", dateTimeNow, fmt);
     FormatUtc("${timestamp}", dateTimeNow, fmt);
     FormatUtc("${offset}", dateTimeNow - dateTimeEpg, fmt);
-    FormatOffset(dateTimeNow - dateTimeEpg, fmt);
+    FormatUtc("${duration}", duration, fmt);
+    FormatUnits(duration, "duration", fmt);
+    FormatUnits(dateTimeNow - dateTimeEpg, "offset", fmt);
     m_XBMC->Log(LOG_DEBUG, "CArchiveConfig::FormatDateTime - \"%s\"", fmt.c_str());
     return fmt;
 }
@@ -116,9 +118,9 @@ void CArchiveConfig::FormatUtc(const char *str, time_t tTime, std::string &fmt)
     }
 }
 
-void CArchiveConfig::FormatOffset(time_t tTime, std::string &fmt) const
+void CArchiveConfig::FormatUnits(time_t tTime, const std::string& name, std::string &fmt) const
 {
-    const std::string regexStr = ".*(\\{offset:(\\d+)\\}).*";
+    const std::string regexStr = ".*(\\{" + name + ":(\\d+)\\}).*";
     std::cmatch mr;
     std::regex rx(regexStr);
     if (std::regex_match(fmt.c_str(), mr, rx) && mr.length() >= 3)
diff --git a/src/ArchiveConfig.h b/src/ArchiveConfig.h
index b376a5f..1474b46 100644
--- a/src/ArchiveConfig.h
+++ b/src/ArchiveConfig.h
@@ -29,7 +29,7 @@ class CArchiveConfig
 public:
     void        ReadSettings(ADDON::CHelper_libXBMC_addon *XBMC);
     bool        IsEnabled() const { return m_bIsEnabled; }
-    std::string FormatDateTime(time_t epgTime, const std::string &url) const;
+    std::string FormatDateTime(time_t epgTime, time_t duration, const std::string &url) const;
     std::string GetArchiveUrlFormat() const { return m_sUrlFormat; }
     time_t      GetTimeshiftBuffer() const { return std::max(static_cast<time_t>(0), m_tTimeshiftBuffer); }
     time_t      GetEpgBeginBuffer() const { return std::max(static_cast<time_t>(0), m_tEpgBeginBuffer); }
@@ -40,7 +40,7 @@ private:
     time_t      GetEpgBufferFromSettings(int setting) const;
     void        FormatTime(const char ch, const struct tm *pTime, std::string &fmt) const;
     void        FormatUtc(const char *str, time_t tTime, std::string &fmt) const;
-    void        FormatOffset(time_t tTime, std::string &fmt) const;
+    void        FormatUnits(time_t tTime, const std::string& name, std::string &fmt) const;
 
     bool        m_bIsEnabled = false;
     std::string m_sUrlFormat;
diff --git a/src/PVRIptvData.cpp b/src/PVRIptvData.cpp
index 3db21ea..65d36fc 100644
--- a/src/PVRIptvData.cpp
+++ b/src/PVRIptvData.cpp
@@ -1657,6 +1657,9 @@ std::string PVRIptvData::BuildEpgTagUrl(const EPG_TAG *tag, const PVRIptvChannel
     if (tag->startTime > 0 && offset < timeNow - 5)
     {
       std::string urlTemplate;
+      time_t duration = 60 * 60; // default one hour
+      if (tag->endTime > 0)
+        duration = std::min(timeNow, tag->endTime) - offset;
       switch (channel.catchupType)
       {
         case CATCHUP_APPEND:
@@ -1668,16 +1671,101 @@ std::string PVRIptvData::BuildEpgTagUrl(const EPG_TAG *tag, const PVRIptvChannel
             urlTemplate = streamUrl + querySep + "utc={utc}&lutc={lutc}";
             break;
           }
+        case CATCHUP_FS:
+          urlTemplate = GenerateFlussonicCatchupSource(streamUrl);
+          break;
+        case CATCHUP_XC:
+          urlTemplate = GenerateXtreamCodesCatchupSource(streamUrl);
+          break;
         case CATCHUP_DEFAULT:
         default:
           urlTemplate = g_ArchiveConfig.GetArchiveUrlFormat().empty() ? channel.strCatchupSource
            : streamUrl + g_ArchiveConfig.GetArchiveUrlFormat();
       }
-      streamUrl = g_ArchiveConfig.FormatDateTime(offset - channel.iTvgShift, urlTemplate);
+      streamUrl = g_ArchiveConfig.FormatDateTime(offset - channel.iTvgShift, duration, urlTemplate);
     }
     return streamUrl + headers;
 }
 
+std::string PVRIptvData::GenerateFlussonicCatchupSource(const std::string& url)
+{
+  // Example stream and catchup URLs
+  // stream:  http://ch01.spr24.net/151/mpegts?token=my_token
+  // catchup: http://ch01.spr24.net/151/timeshift_abs-{utc}.ts?token=my_token
+  // stream:  http://list.tv:8888/325/index.m3u8?token=secret
+  // catchup: http://list.tv:8888/325/timeshift_rel-{offset:1}.m3u8?token=secret
+  // stream:  http://list.tv:8888/325/mono.m3u8?token=secret
+  // catchup: http://list.tv:8888/325/mono-timeshift_rel-{offset:1}.m3u8?token=secret
+
+  static std::regex fsRegex("^(http[s]?://[^/]+)/([^/]+)/([^/]*)(mpegts|\\.m3u8)(\\?.+=.+)?$");
+  std::smatch matches;
+  std::string urlTemplate = url;
+
+  if (std::regex_match(url, matches, fsRegex))
+  {
+    if (matches.size() == 6)
+    {
+      const std::string fsHost = matches[1].str();
+      const std::string fsChannelId = matches[2].str();
+      const std::string fsListType = matches[3].str();
+      const std::string fsStreamType = matches[4].str();
+      const std::string fsUrlAppend = matches[5].str();
+
+      bool isCatchupTSStream = fsStreamType == "mpegts";
+      if (isCatchupTSStream)
+      {
+        urlTemplate = fsHost + "/" + fsChannelId + "/timeshift_abs-${start}.ts" + fsUrlAppend;
+      }
+      else
+      {
+        if (fsListType == "index")
+          urlTemplate = fsHost + "/" + fsChannelId + "/timeshift_rel-{offset:1}.m3u8" + fsUrlAppend;
+        else
+          urlTemplate = fsHost + "/" + fsChannelId + "/" + fsListType + "-timeshift_rel-{offset:1}.m3u8" + fsUrlAppend;
+      }
+    }
+  }
+
+  return urlTemplate;
+}
+
+std::string PVRIptvData::GenerateXtreamCodesCatchupSource(const std::string& url)
+{
+  // Example stream and catchup URLs
+  // stream:  http://list.tv:8080/my@account.xc/my_password/1477
+  // catchup: http://list.tv:8080/timeshift/my@account.xc/my_password/{duration}/{Y}-{m}-{d}:{H}-{M}/1477.ts
+  // stream:  http://list.tv:8080/live/my@account.xc/my_password/1477.m3u8
+  // catchup: http://list.tv:8080/timeshift/my@account.xc/my_password/{duration}/{Y}-{m}-{d}:{H}-{M}/1477.m3u8
+
+  static std::regex xcRegex("^(http[s]?://[^/]+)/(?:live/)?([^/]+)/([^/]+)/([^/\\.]+)(\\.m3u[8]?)?$");
+  std::smatch matches;
+  std::string urlTemplate = url;
+
+  if (std::regex_match(url, matches, xcRegex))
+  {
+    if (matches.size() == 6)
+    {
+      const std::string xcHost = matches[1].str();
+      const std::string xcUsername = matches[2].str();
+      const std::string xcPasssword = matches[3].str();
+      const std::string xcChannelId = matches[4].str();
+      std::string xcExtension;
+      if (matches[5].matched)
+        xcExtension = matches[5].str();
+
+      if (xcExtension.empty())
+      {
+        xcExtension = ".ts";
+      }
+
+      urlTemplate = xcHost + "/timeshift/" + xcUsername + "/" + xcPasssword +
+                        "/{duration:60}/{Y}-{m}-{d}:{H}-{M}/" + xcChannelId + xcExtension;
+    }
+  }
+
+  return urlTemplate;
+}
+
 bool PVRIptvData::GetLiveEPGTag(const PVRIptvChannel &myChannel, EPG_TAG &tag, bool addTvgShift)
 {
   bool ret = false;
diff --git a/src/PVRIptvData.h b/src/PVRIptvData.h
index 245dfeb..8d7e7ba 100644
--- a/src/PVRIptvData.h
+++ b/src/PVRIptvData.h
@@ -166,6 +166,8 @@ private:
   static bool ParseXmltvNsEpisodeNumberInfo(const std::string& episodeNumberString, PVRIptvEpgEntry& entry);
   static bool ParseOnScreenEpisodeNumberInfo(const std::string& episodeNumberString, PVRIptvEpgEntry& entry);
 
+  virtual std::string GenerateFlussonicCatchupSource(const std::string& url);
+  virtual std::string GenerateXtreamCodesCatchupSource(const std::string& url);
   virtual void ProcessGroupLine(std::string groupsLine, bool bRadio, std::vector<int>& iCurrentGroupId);
 
   bool                              m_bTSOverride;
diff --git a/src/client.cpp b/src/client.cpp
index c6acdae..7813f56 100644
--- a/src/client.cpp
+++ b/src/client.cpp
@@ -457,10 +457,11 @@ PVR_ERROR GetEPGTagStreamProperties(const EPG_TAG* tag,
   *iPropertiesCount = 0;
   XBMC->Log(LOG_DEBUG, "GetEPGTagStreamProperties - GetPlayEpgAsLive is %s",
             g_ArchiveConfig.GetPlayEpgAsLive() ? "enabled" : "disabled");
+  std::string epgStrUrl;
   if (g_ArchiveConfig.GetPlayEpgAsLive())
   {
     g_bResetUrlOffset = false;
-    m_data->GetEpgTagUrl(tag, m_currentChannel);
+    epgStrUrl = m_data->GetEpgTagUrl(tag, m_currentChannel);
     time_t timeNow = time(0);
     time_t programOffset = timeNow - m_currentChannel.epgTag.startTime;
     time_t timeshiftBuffer = std::max(programOffset, g_ArchiveConfig.GetTimeshiftBuffer());
@@ -472,7 +473,7 @@ PVR_ERROR GetEPGTagStreamProperties(const EPG_TAG* tag,
   else if (g_bResetUrlOffset)
   {
     g_bResetUrlOffset = false;
-    m_data->GetEpgTagUrl(tag, m_currentChannel);
+    epgStrUrl = m_data->GetEpgTagUrl(tag, m_currentChannel);
     const time_t beginBuffer = g_ArchiveConfig.GetEpgBeginBuffer();
     const time_t endBuffer = g_ArchiveConfig.GetEpgEndBuffer();
     m_currentChannel.timeshiftStartTime = m_currentChannel.epgTag.startTime - beginBuffer;
@@ -480,7 +481,11 @@ PVR_ERROR GetEPGTagStreamProperties(const EPG_TAG* tag,
     m_currentChannel.epgTag.endTime += endBuffer;
     m_data->SetEpgUrlTimeOffset(beginBuffer);
   }
-  std::string epgStrUrl = m_data->GetEpgTagUrl(nullptr, m_currentChannel);
+  else
+  {
+    epgStrUrl = m_data->GetEpgTagUrl(nullptr, m_currentChannel);
+  }
+
   if (!epgStrUrl.empty())
   {
     g_bIsArchive = true;
-- 
2.25.1


From 1036a88fd972993f4b6f5a7215b8229c14947552 Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Sat, 20 Jun 2020 23:11:32 +0300
Subject: [PATCH 10/11] Allow user to select archive type

---
 .../resource.language.de_de/strings.po        | 36 ++++++++++++
 .../resource.language.en_gb/strings.po        | 36 ++++++++++++
 .../resource.language.ru_ru/strings.po        | 36 ++++++++++++
 pvr.iptvsimple/resources/settings.xml         | 16 +++---
 src/ArchiveConfig.cpp                         | 10 +++-
 src/ArchiveConfig.h                           | 50 +++++++++++------
 src/PVRIptvData.cpp                           | 55 ++++++++++++-------
 src/PVRIptvData.h                             | 10 ----
 8 files changed, 191 insertions(+), 58 deletions(-)

diff --git a/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po b/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
index 57d1801..4bdbf53 100644
--- a/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
@@ -201,3 +201,39 @@ msgstr "6 Tage"
 msgctxt "#30096"
 msgid "7 days"
 msgstr "7 Tage"
+
+msgctxt "#30100"
+msgid "Archive type"
+msgstr "Archiv Typ"
+
+msgctxt "#30101"
+msgid "Disabled"
+msgstr "Deaktiviert"
+
+msgctxt "#30102"
+msgid "Default"
+msgstr "Voreinstellung"
+
+msgctxt "#30103"
+msgid "Custom"
+msgstr "Benutzerdefiniert"
+
+msgctxt "#30104"
+msgid "Append"
+msgstr ""
+
+msgctxt "#30105"
+msgid "Shift (SIPTV)"
+msgstr ""
+
+msgctxt "#30106"
+msgid "Flussonic"
+msgstr ""
+
+msgctxt "#30107"
+msgid "Xtream Codes"
+msgstr ""
+
+msgctxt "#30108"
+msgid "Ezserver"
+msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po b/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
index 2f11805..899ca53 100644
--- a/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
@@ -215,3 +215,39 @@ msgstr ""
 msgctxt "#30096"
 msgid "7 days"
 msgstr ""
+
+msgctxt "#30100"
+msgid "Archive type"
+msgstr ""
+
+msgctxt "#30101"
+msgid "Disabled"
+msgstr ""
+
+msgctxt "#30102"
+msgid "Default"
+msgstr ""
+
+msgctxt "#30103"
+msgid "Custom"
+msgstr ""
+
+msgctxt "#30104"
+msgid "Append"
+msgstr ""
+
+msgctxt "#30105"
+msgid "Shift (SIPTV)"
+msgstr ""
+
+msgctxt "#30106"
+msgid "Flussonic"
+msgstr ""
+
+msgctxt "#30107"
+msgid "Xtream Codes"
+msgstr ""
+
+msgctxt "#30108"
+msgid "Ezserver"
+msgstr ""
diff --git a/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po b/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
index 8224a35..070de9f 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
@@ -201,3 +201,39 @@ msgstr "6 дней"
 msgctxt "#30096"
 msgid "7 days"
 msgstr "7 дней"
+
+msgctxt "#30100"
+msgid "Archive type"
+msgstr "Тип архива"
+
+msgctxt "#30101"
+msgid "Disabled"
+msgstr "Отключен"
+
+msgctxt "#30102"
+msgid "Default"
+msgstr "По умолчанию"
+
+msgctxt "#30103"
+msgid "Custom"
+msgstr "Пользовательский"
+
+msgctxt "#30104"
+msgid "Append"
+msgstr ""
+
+msgctxt "#30105"
+msgid "Shift (SIPTV)"
+msgstr ""
+
+msgctxt "#30106"
+msgid "Flussonic"
+msgstr ""
+
+msgctxt "#30107"
+msgid "Xtream Codes"
+msgstr ""
+
+msgctxt "#30108"
+msgid "Ezserver"
+msgstr ""
diff --git a/pvr.iptvsimple/resources/settings.xml b/pvr.iptvsimple/resources/settings.xml
index 751d890..d31ce11 100644
--- a/pvr.iptvsimple/resources/settings.xml
+++ b/pvr.iptvsimple/resources/settings.xml
@@ -35,13 +35,13 @@
   <!-- Archive -->
   <category label="30060">
     <setting id="sep4" label="30060" type="lsep"/>
-    <setting id="archEnable" type="bool" label="30061" default="false"/>
-    <setting id="archUrlFormat" type="text" label="30062" default="" visible="eq(-1,true)"/>
-    <setting id="sep4" label="30063" type="lsep" visible="eq(-2,true)"/>
-    <setting id="archTimeshiftBuffer" type="enum" label="30064" lvalues="30090|30091|30092|30093|30094|30095|30096" default="3" visible="eq(-3,true)"/>
-    <setting id="archPlayEpgAsLive" type="bool" label="30068" default="false" visible="eq(-4,true)"/>
-    <setting id="sep4" label="30065" type="lsep" visible="eq(-5,true) + !eq(-1,true)"/>
-    <setting id="archBeginBuffer" type="enum" label="30066" lvalues="30080|30081|30082|30083|30084|30085|30086" default="2" visible="eq(-6,true) + !eq(-2,true)"/>
-    <setting id="archEndBuffer" type="enum" label="30067" lvalues="30080|30081|30082|30083|30084|30085|30086" default="4" visible="eq(-7,true) + !eq(-3,true)"/>
+    <setting id="archType" type="enum" label="30100" lvalues="30101|30102|30103|30104|30105|30106|30107" default="1"/>
+    <setting id="archUrlFormat" type="text" label="30062" default="" visible="eq(-1,2)"/>
+    <setting id="sep4" label="30063" type="lsep" visible="!eq(-2,0)"/>
+    <setting id="archTimeshiftBuffer" type="enum" label="30064" lvalues="30090|30091|30092|30093|30094|30095|30096" default="3" visible="!eq(-3,0)"/>
+    <setting id="archPlayEpgAsLive" type="bool" label="30068" default="false" visible="!eq(-4,0)"/>
+    <setting id="sep4" label="30065" type="lsep" visible="!eq(-5,0) + !eq(-1,true)"/>
+    <setting id="archBeginBuffer" type="enum" label="30066" lvalues="30080|30081|30082|30083|30084|30085|30086" default="2" visible="!eq(-6,0) + !eq(-2,true)"/>
+    <setting id="archEndBuffer" type="enum" label="30067" lvalues="30080|30081|30082|30083|30084|30085|30086" default="4" visible="!eq(-7,0) + !eq(-3,true)"/>
   </category>
 </settings>
diff --git a/src/ArchiveConfig.cpp b/src/ArchiveConfig.cpp
index e1243a1..b1e249b 100644
--- a/src/ArchiveConfig.cpp
+++ b/src/ArchiveConfig.cpp
@@ -29,10 +29,16 @@ using namespace ADDON;
 void CArchiveConfig::ReadSettings(CHelper_libXBMC_addon *XBMC)
 {
     m_XBMC = XBMC;
-    if (!XBMC->GetSetting("archEnable", &m_bIsEnabled))
+    if (!XBMC->GetSetting("archType", &m_iArchiveType))
     {
-        m_bIsEnabled = false;
+        m_iArchiveType = CATCHUP_DEFAULT;
+        bool legacyEnabled;
+        if (XBMC->GetSetting("archEnable", &legacyEnabled) && legacyEnabled)
+        {
+            m_iArchiveType = CATCHUP_CUSTOM;
+        }
     }
+    m_bIsEnabled = GetArchiveType() > CATCHUP_DISABLED;
     char buffer[1024];
     if (XBMC->GetSetting("archUrlFormat", &buffer))
     {
diff --git a/src/ArchiveConfig.h b/src/ArchiveConfig.h
index 1474b46..0c0a526 100644
--- a/src/ArchiveConfig.h
+++ b/src/ArchiveConfig.h
@@ -24,30 +24,44 @@
 #include "p8-platform/os.h"
 #include "libXBMC_addon.h"
 
+enum CatchupTypes
+{
+  CATCHUP_DISABLED,
+  CATCHUP_DEFAULT,
+  CATCHUP_CUSTOM,
+  CATCHUP_APPEND,
+  CATCHUP_TIMESHIFT,
+  CATCHUP_FS,
+  CATCHUP_XC,
+  CATCHUP_EZTS,
+};
+
 class CArchiveConfig
 {
 public:
-    void        ReadSettings(ADDON::CHelper_libXBMC_addon *XBMC);
-    bool        IsEnabled() const { return m_bIsEnabled; }
-    std::string FormatDateTime(time_t epgTime, time_t duration, const std::string &url) const;
-    std::string GetArchiveUrlFormat() const { return m_sUrlFormat; }
-    time_t      GetTimeshiftBuffer() const { return std::max(static_cast<time_t>(0), m_tTimeshiftBuffer); }
-    time_t      GetEpgBeginBuffer() const { return std::max(static_cast<time_t>(0), m_tEpgBeginBuffer); }
-    time_t      GetEpgEndBuffer() const { return std::max(static_cast<time_t>(0), m_tEpgEndBuffer); }
-    bool        GetPlayEpgAsLive() const { return m_bPlayEpgAsLive; }
+    void            ReadSettings(ADDON::CHelper_libXBMC_addon *XBMC);
+    bool            IsEnabled() const { return m_bIsEnabled; }
+    std::string     FormatDateTime(time_t epgTime, time_t duration, const std::string &url) const;
+    std::string     GetArchiveUrlFormat() const { return m_sUrlFormat; }
+    CatchupTypes    GetArchiveType() const { return static_cast<CatchupTypes>(m_iArchiveType); }
+    time_t          GetTimeshiftBuffer() const { return std::max(static_cast<time_t>(0), m_tTimeshiftBuffer); }
+    time_t          GetEpgBeginBuffer() const { return std::max(static_cast<time_t>(0), m_tEpgBeginBuffer); }
+    time_t          GetEpgEndBuffer() const { return std::max(static_cast<time_t>(0), m_tEpgEndBuffer); }
+    bool            GetPlayEpgAsLive() const { return m_bPlayEpgAsLive; }
 
 private:
-    time_t      GetEpgBufferFromSettings(int setting) const;
-    void        FormatTime(const char ch, const struct tm *pTime, std::string &fmt) const;
-    void        FormatUtc(const char *str, time_t tTime, std::string &fmt) const;
-    void        FormatUnits(time_t tTime, const std::string& name, std::string &fmt) const;
+    time_t          GetEpgBufferFromSettings(int setting) const;
+    void            FormatTime(const char ch, const struct tm *pTime, std::string &fmt) const;
+    void            FormatUtc(const char *str, time_t tTime, std::string &fmt) const;
+    void            FormatUnits(time_t tTime, const std::string& name, std::string &fmt) const;
 
-    bool        m_bIsEnabled = false;
-    std::string m_sUrlFormat;
-    time_t      m_tTimeshiftBuffer = -1;
-    time_t      m_tEpgBeginBuffer = -1;
-    time_t      m_tEpgEndBuffer = -1;
-    bool        m_bPlayEpgAsLive = false;
+    bool            m_bIsEnabled = false;
+    std::string     m_sUrlFormat;
+    int             m_iArchiveType = 1;
+    time_t          m_tTimeshiftBuffer = -1;
+    time_t          m_tEpgBeginBuffer = -1;
+    time_t          m_tEpgEndBuffer = -1;
+    bool            m_bPlayEpgAsLive = false;
 
     ADDON::CHelper_libXBMC_addon *m_XBMC = nullptr;
 };
diff --git a/src/PVRIptvData.cpp b/src/PVRIptvData.cpp
index 65d36fc..662ee8d 100644
--- a/src/PVRIptvData.cpp
+++ b/src/PVRIptvData.cpp
@@ -36,10 +36,10 @@
 
 #include "zlib.h"
 #include "rapidxml/rapidxml.hpp"
-#include "PVRIptvData.h"
 #include "p8-platform/util/StringUtils.h"
-#include "client.h"
 #include "ArchiveConfig.h"
+#include "PVRIptvData.h"
+#include "client.h"
 
 #define M3U_START_MARKER        "#EXTM3U"
 #define M3U_GROUP_MARKER        "#EXTGRP:"
@@ -756,21 +756,28 @@ bool PVRIptvData::LoadPlayList(void)
           tmpChannel.iCatchupLength = 24 * 60 * 60 * atoi(strCatchupDays.c_str());
         }
 
-        if (strCatchupType.empty())
-          strCatchupType = globalStrCatchupType;
-
-        if (strCatchupType == "append")
-          tmpChannel.catchupType = CATCHUP_APPEND;
-        else if (strCatchupType == "shift" || strCatchupType == "timeshift")
-          tmpChannel.catchupType = CATCHUP_TIMESHIFT;
-        else if (strCatchupType == "xc")
-          tmpChannel.catchupType = CATCHUP_XC;
-        else if (strCatchupType == "ez-ts")
-          tmpChannel.catchupType = CATCHUP_EZTS;
-        else if (strCatchupType == "fs")
-          tmpChannel.catchupType = CATCHUP_FS;
+        if (g_ArchiveConfig.GetArchiveType() == CATCHUP_DEFAULT)
+        {
+          if (strCatchupType.empty())
+            strCatchupType = globalStrCatchupType;
+
+          if (strCatchupType == "append")
+            tmpChannel.catchupType = CATCHUP_APPEND;
+          else if (strCatchupType == "shift" || strCatchupType == "timeshift")
+            tmpChannel.catchupType = CATCHUP_TIMESHIFT;
+          else if (strCatchupType == "xc")
+            tmpChannel.catchupType = CATCHUP_XC;
+          else if (strCatchupType == "ez-ts" || strCatchupType == "Ezserver")
+            tmpChannel.catchupType = CATCHUP_EZTS;
+          else if (strCatchupType == "fs" || strCatchupType == "flussonic" || strCatchupType == "flussonic-ts")
+            tmpChannel.catchupType = CATCHUP_FS;
+          else
+            tmpChannel.catchupType = CATCHUP_DEFAULT;
+        }
         else
-          tmpChannel.catchupType = CATCHUP_DEFAULT;
+        {
+          tmpChannel.catchupType = g_ArchiveConfig.GetArchiveType();
+        }
 
         iChannelGroupName = strGroupName;
         ProcessGroupLine(strGroupName, bRadio, iCurrentGroupId);
@@ -1677,10 +1684,14 @@ std::string PVRIptvData::BuildEpgTagUrl(const EPG_TAG *tag, const PVRIptvChannel
         case CATCHUP_XC:
           urlTemplate = GenerateXtreamCodesCatchupSource(streamUrl);
           break;
+        case CATCHUP_CUSTOM:
+          urlTemplate = streamUrl + g_ArchiveConfig.GetArchiveUrlFormat();
+          break;
         case CATCHUP_DEFAULT:
+          urlTemplate = !channel.strCatchupSource.empty() ? channel.strCatchupSource : streamUrl;
+          break;
         default:
-          urlTemplate = g_ArchiveConfig.GetArchiveUrlFormat().empty() ? channel.strCatchupSource
-           : streamUrl + g_ArchiveConfig.GetArchiveUrlFormat();
+          urlTemplate = streamUrl;
       }
       streamUrl = g_ArchiveConfig.FormatDateTime(offset - channel.iTvgShift, duration, urlTemplate);
     }
@@ -1813,11 +1824,15 @@ bool PVRIptvData::IsArchiveSupportedOnChannel(const PVRIptvChannel &channel)
   switch (channel.catchupType)
   {
     case CATCHUP_APPEND:
+    case CATCHUP_DEFAULT:
       return !channel.strCatchupSource.empty();
     case CATCHUP_TIMESHIFT:
+    case CATCHUP_FS:
+    case CATCHUP_XC:
       return true;
-    case CATCHUP_DEFAULT:
+    case CATCHUP_CUSTOM:
+      return !g_ArchiveConfig.GetArchiveUrlFormat().empty();
     default:
-      return !g_ArchiveConfig.GetArchiveUrlFormat().empty() || !channel.strCatchupSource.empty();
+      return false;
   }
 }
diff --git a/src/PVRIptvData.h b/src/PVRIptvData.h
index 8d7e7ba..205e04d 100644
--- a/src/PVRIptvData.h
+++ b/src/PVRIptvData.h
@@ -64,16 +64,6 @@ struct PVRIptvEpgChannel
   std::vector<PVRIptvEpgEntry> epg;
 };
 
-enum CatchupTypes
-{
-  CATCHUP_DEFAULT,
-  CATCHUP_APPEND,
-  CATCHUP_TIMESHIFT,
-  CATCHUP_XC,
-  CATCHUP_EZTS,
-  CATCHUP_FS,
-};
-
 struct PVRIptvChannel
 {
   bool        bRadio;
-- 
2.25.1


From c941ae1d32bcd7f8a0231833087ba3384c9570a9 Mon Sep 17 00:00:00 2001
From: Arthur Liberman <arthur_liberman@hotmail.com>
Date: Sat, 2 Jan 2021 19:08:53 +0200
Subject: [PATCH 11/11] Add support for tvg-rec tag, same as catchup-days

---
 .../language/resource.language.de_de/strings.po  | 16 ++++++++++------
 .../language/resource.language.en_gb/strings.po  | 16 ++++++++++------
 .../language/resource.language.ru_ru/strings.po  | 16 ++++++++++------
 pvr.iptvsimple/resources/settings.xml            |  2 +-
 src/ArchiveConfig.cpp                            |  2 +-
 src/PVRIptvData.cpp                              |  7 ++++++-
 src/client.cpp                                   |  6 +++---
 7 files changed, 41 insertions(+), 24 deletions(-)

diff --git a/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po b/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
index 4bdbf53..11c5431 100644
--- a/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.de_de/strings.po
@@ -175,30 +175,34 @@ msgstr "60 Minuten"
 #empty strings from id 30087 to 30089
 
 msgctxt "#30090"
+msgid "0 days"
+msgstr "0 Tage"
+
+msgctxt "#30091"
 msgid "1 day"
 msgstr "1 Tag"
 
-msgctxt "#30091"
+msgctxt "#30092"
 msgid "2 days"
 msgstr "2 Tage"
 
-msgctxt "#30092"
+msgctxt "#30093"
 msgid "3 days"
 msgstr "3 Tage"
 
-msgctxt "#30093"
+msgctxt "#30094"
 msgid "4 days"
 msgstr "4 Tage"
 
-msgctxt "#30094"
+msgctxt "#30095"
 msgid "5 days"
 msgstr "5 Tage"
 
-msgctxt "#30095"
+msgctxt "#30096"
 msgid "6 days"
 msgstr "6 Tage"
 
-msgctxt "#30096"
+msgctxt "#30097"
 msgid "7 days"
 msgstr "7 Tage"
 
diff --git a/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po b/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
index 899ca53..2a6d013 100644
--- a/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.en_gb/strings.po
@@ -189,30 +189,34 @@ msgstr ""
 #empty strings from id 30087 to 30089
 
 msgctxt "#30090"
-msgid "1 day"
+msgid "0 days"
 msgstr ""
 
 msgctxt "#30091"
-msgid "2 days"
+msgid "1 day"
 msgstr ""
 
 msgctxt "#30092"
-msgid "3 days"
+msgid "2 days"
 msgstr ""
 
 msgctxt "#30093"
-msgid "4 days"
+msgid "3 days"
 msgstr ""
 
 msgctxt "#30094"
-msgid "5 days"
+msgid "4 days"
 msgstr ""
 
 msgctxt "#30095"
-msgid "6 days"
+msgid "5 days"
 msgstr ""
 
 msgctxt "#30096"
+msgid "6 days"
+msgstr ""
+
+msgctxt "#30097"
 msgid "7 days"
 msgstr ""
 
diff --git a/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po b/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
index 070de9f..24a7ff6 100644
--- a/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
+++ b/pvr.iptvsimple/resources/language/resource.language.ru_ru/strings.po
@@ -175,30 +175,34 @@ msgstr "60 минут"
 #empty strings from id 30087 to 30089
 
 msgctxt "#30090"
+msgid "0 days"
+msgstr "0 дней"
+
+msgctxt "#30091"
 msgid "1 day"
 msgstr "1 день"
 
-msgctxt "#30091"
+msgctxt "#30092"
 msgid "2 days"
 msgstr "2 дня"
 
-msgctxt "#30092"
+msgctxt "#30093"
 msgid "3 days"
 msgstr "3 дня"
 
-msgctxt "#30093"
+msgctxt "#30094"
 msgid "4 days"
 msgstr "4 дня"
 
-msgctxt "#30094"
+msgctxt "#30095"
 msgid "5 days"
 msgstr "5 дней"
 
-msgctxt "#30095"
+msgctxt "#30096"
 msgid "6 days"
 msgstr "6 дней"
 
-msgctxt "#30096"
+msgctxt "#30097"
 msgid "7 days"
 msgstr "7 дней"
 
diff --git a/pvr.iptvsimple/resources/settings.xml b/pvr.iptvsimple/resources/settings.xml
index d31ce11..b25d838 100644
--- a/pvr.iptvsimple/resources/settings.xml
+++ b/pvr.iptvsimple/resources/settings.xml
@@ -38,7 +38,7 @@
     <setting id="archType" type="enum" label="30100" lvalues="30101|30102|30103|30104|30105|30106|30107" default="1"/>
     <setting id="archUrlFormat" type="text" label="30062" default="" visible="eq(-1,2)"/>
     <setting id="sep4" label="30063" type="lsep" visible="!eq(-2,0)"/>
-    <setting id="archTimeshiftBuffer" type="enum" label="30064" lvalues="30090|30091|30092|30093|30094|30095|30096" default="3" visible="!eq(-3,0)"/>
+    <setting id="archTimeshiftBuffer" type="enum" label="30064" lvalues="30090|30091|30092|30093|30094|30095|30096|30097" default="4" visible="!eq(-3,0)"/>
     <setting id="archPlayEpgAsLive" type="bool" label="30068" default="false" visible="!eq(-4,0)"/>
     <setting id="sep4" label="30065" type="lsep" visible="!eq(-5,0) + !eq(-1,true)"/>
     <setting id="archBeginBuffer" type="enum" label="30066" lvalues="30080|30081|30082|30083|30084|30085|30086" default="2" visible="!eq(-6,0) + !eq(-2,true)"/>
diff --git a/src/ArchiveConfig.cpp b/src/ArchiveConfig.cpp
index b1e249b..e4ed6ef 100644
--- a/src/ArchiveConfig.cpp
+++ b/src/ArchiveConfig.cpp
@@ -47,7 +47,7 @@ void CArchiveConfig::ReadSettings(CHelper_libXBMC_addon *XBMC)
     int temp = 0;
     if (XBMC->GetSetting("archTimeshiftBuffer", &temp))
     {
-        m_tTimeshiftBuffer = static_cast<time_t>(++temp) * 24*60*60;
+        m_tTimeshiftBuffer = static_cast<time_t>(temp) * 24*60*60;
     }
     else
     {
diff --git a/src/PVRIptvData.cpp b/src/PVRIptvData.cpp
index 662ee8d..e4696ce 100644
--- a/src/PVRIptvData.cpp
+++ b/src/PVRIptvData.cpp
@@ -50,6 +50,7 @@
 #define TVG_INFO_LOGO_MARKER    "tvg-logo="
 #define TVG_INFO_SHIFT_MARKER   "tvg-shift="
 #define TVG_INFO_CHNO_MARKER    "tvg-chno="
+#define TVG_INFO_REC            "tvg-rec="
 #define GROUP_NAME_MARKER       "group-title="
 #define CATCHUP_TYPE            "catchup="
 #define CATCHUP_SOURCE          "catchup-source="
@@ -649,6 +650,8 @@ bool PVRIptvData::LoadPlayList(void)
         globalStrCatchupType = ReadMarkerValue(strLine, CATCHUP_TYPE);
         globalStrCatchupSource = ReadMarkerValue(strLine, CATCHUP_SOURCE);
         globalStrCatchupDays = ReadMarkerValue(strLine, CATCHUP_DAYS);
+        if (globalStrCatchupDays.empty())
+          globalStrCatchupDays = ReadMarkerValue(strLine, TVG_INFO_REC);
         continue;
       }
       else
@@ -704,6 +707,8 @@ bool PVRIptvData::LoadPlayList(void)
         strCatchupType = ReadMarkerValue(strInfoLine, CATCHUP_TYPE);
         strCatchupSource = ReadMarkerValue(strInfoLine, CATCHUP_SOURCE);
         strCatchupDays   = ReadMarkerValue(strInfoLine, CATCHUP_DAYS);
+        if (strCatchupDays.empty())
+          strCatchupDays = ReadMarkerValue(strInfoLine, TVG_INFO_REC);
 
         if (strTvgId.empty())
           strTvgId = ReadMarkerValue(strInfoLine, TVG_INFO_ID_MARKER_UC);
@@ -1818,7 +1823,7 @@ bool PVRIptvData::IsArchiveSupportedOnChannel(int uniqueId)
 
 bool PVRIptvData::IsArchiveSupportedOnChannel(const PVRIptvChannel &channel)
 {
-  if (!g_ArchiveConfig.IsEnabled())
+  if (!g_ArchiveConfig.IsEnabled() || channel.iCatchupLength == 0)
     return false;
 
   switch (channel.catchupType)
diff --git a/src/client.cpp b/src/client.cpp
index 7813f56..840144a 100644
--- a/src/client.cpp
+++ b/src/client.cpp
@@ -371,8 +371,8 @@ PVR_ERROR GetChannelStreamProperties(const PVR_CHANNEL* channel, PVR_NAMED_VALUE
       g_bResetUrlOffset = false;
       if (m_data->IsArchiveSupportedOnChannel(m_currentChannel))
       {
-        m_data->SetEpgUrlTimeOffset(g_ArchiveConfig.GetTimeshiftBuffer());
-        m_currentChannel.timeshiftStartTime = time(0) - g_ArchiveConfig.GetTimeshiftBuffer();
+        m_data->SetEpgUrlTimeOffset(m_currentChannel.iCatchupLength);
+        m_currentChannel.timeshiftStartTime = time(0) - m_currentChannel.iCatchupLength;
       }
       else
       {
@@ -464,7 +464,7 @@ PVR_ERROR GetEPGTagStreamProperties(const EPG_TAG* tag,
     epgStrUrl = m_data->GetEpgTagUrl(tag, m_currentChannel);
     time_t timeNow = time(0);
     time_t programOffset = timeNow - m_currentChannel.epgTag.startTime;
-    time_t timeshiftBuffer = std::max(programOffset, g_ArchiveConfig.GetTimeshiftBuffer());
+    time_t timeshiftBuffer = std::max(programOffset, static_cast<time_t>(m_currentChannel.iCatchupLength));
     m_currentChannel.timeshiftStartTime = timeNow - timeshiftBuffer;
     m_currentChannel.epgTag.startTime = m_currentChannel.timeshiftStartTime;
     m_currentChannel.epgTag.endTime = timeNow;
-- 
2.25.1

